"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),require("leaflet"),require("leaflet/dist/leaflet.css"),require("proj4"),require("proj4leaflet");var e=require("mitt"),t=require("axios");require("leaflet-draw"),require("leaflet-draw/dist/leaflet.draw-src.css");var r=require("nanoid");function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=n(e),a=n(t);function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){p(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
s=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",i=n.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function l(e,t,r,n){var o=t&&t.prototype instanceof d?t:d,a=Object.create(o.prototype),i=new _(n||[]);return a._invoke=function(e,t,r){var n="suspendedStart";return function(o,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw a;return T()}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var c=L(i,r);if(c){if(c===p)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var s=u(e,t,r);if("normal"===s.type){if(n=r.done?"completed":"suspendedYield",s.arg===p)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n="completed",r.method="throw",r.arg=s.arg)}}}(e,r,i),a}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var p={};function d(){}function f(){}function h(){}var v={};c(v,o,(function(){return this}));var y=Object.getPrototypeOf,m=y&&y(y(E([])));m&&m!==t&&r.call(m,o)&&(v=m);var g=h.prototype=d.prototype=Object.create(v);function w(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function n(o,a,i,c){var s=u(e[o],e,a);if("throw"!==s.type){var l=s.arg,p=l.value;return p&&"object"==typeof p&&r.call(p,"__await")?t.resolve(p.__await).then((function(e){n("next",e,i,c)}),(function(e){n("throw",e,i,c)})):t.resolve(p).then((function(e){l.value=e,i(l)}),(function(e){return n("throw",e,i,c)}))}c(s.arg)}var o;this._invoke=function(e,r){function a(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(a,a):a()}}function L(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,L(e,t),"throw"===t.method))return p;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var n=u(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,p;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function _(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function E(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:T}}function T(){return{value:void 0,done:!0}}return f.prototype=h,c(g,"constructor",h),c(h,"constructor",f),f.displayName=c(h,i,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,c(e,i,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},w(b.prototype),c(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new b(l(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},w(g),c(g,i,"Generator"),c(g,o,(function(){return this})),c(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=E,_.prototype={constructor:_,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return i.type="throw",i.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),s=r.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,p):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:E(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),p}},e}function l(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function u(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){l(a,n,o,i,c,"next",e)}function c(e){l(a,n,o,i,c,"throw",e)}i(void 0)}))}}function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}L.Proj&&(L.CRS.Baidu=new L.Proj.CRS("EPSG:900913","+proj=merc +a=6378206 +b=6356584.314245179 +lat_ts=0.0 +lon_0=0.0 +x_0=0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs",{resolutions:function(){var e=[];e[0]=Math.pow(2,18);for(var t=1;t<19;t++)e[t]=Math.pow(2,18-t);return e}(),origin:[0,0],bounds:L.bounds([20037508.342789244,0],[0,20037508.342789244])})),L.TileLayer.ChinaProvider=L.TileLayer.extend({initialize:function(e,t){var r=L.TileLayer.ChinaProvider.providers;t=t||{};var n=e.split("."),o=n[0],a=n[1],i=n[2],c=r[o][a][i];t.subdomains=r[o].Subdomains,t.key=t.key||r[o].key,"tms"in r[o]&&(t.tms=r[o].tms),L.TileLayer.prototype.initialize.call(this,c,t)},getTileUrl:function(e){var t={s:this._getSubdomain(e),x:e.x,y:e.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var r=this._globalTileRange.max.y-e.y;this.options.tms&&(t.y=r),t["-y"]=r}return t.sx=t.x>>4,t.sy=(1<<t.z)-t.y>>4,L.Util.template(this._url,L.Util.extend(t,this.options))}}),L.TileLayer.ChinaProvider.providers={TianDiTu:{Normal:{Map:"//t{s}.tianditu.gov.cn/DataServer?T=vec_w&X={x}&Y={y}&L={z}&tk={key}",Annotion:"//t{s}.tianditu.gov.cn/DataServer?T=cva_w&X={x}&Y={y}&L={z}&tk={key}"},Satellite:{Map:"//t{s}.tianditu.gov.cn/DataServer?T=img_w&X={x}&Y={y}&L={z}&tk={key}",Annotion:"//t{s}.tianditu.gov.cn/DataServer?T=cia_w&X={x}&Y={y}&L={z}&tk={key}"},Terrain:{Map:"//t{s}.tianditu.gov.cn/DataServer?T=ter_w&X={x}&Y={y}&L={z}&tk={key}",Annotion:"//t{s}.tianditu.gov.cn/DataServer?T=cta_w&X={x}&Y={y}&L={z}&tk={key}"},Subdomains:["0","1","2","3","4","5","6","7"],key:"174705aebfe31b79b3587279e211cb9a"},GaoDe:{Normal:{Map:"//webrd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}"},Satellite:{Map:"//webst0{s}.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}",Annotion:"//webst0{s}.is.autonavi.com/appmaptile?style=8&x={x}&y={y}&z={z}"},Subdomains:["1","2","3","4"],Brief:{Map:"//webrd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}"}},Google:{Normal:{Map:"//www.google.cn/maps/vt?lyrs=m@189&gl=cn&x={x}&y={y}&z={z}"},Satellite:{Map:"//www.google.cn/maps/vt?lyrs=s@189&gl=cn&x={x}&y={y}&z={z}",Annotion:"//www.google.cn/maps/vt?lyrs=y@189&gl=cn&x={x}&y={y}&z={z}"},Subdomains:[]},Geoq:{Normal:{Map:"//map.geoq.cn/ArcGIS/rest/services/ChinaOnlineCommunity/MapServer/tile/{z}/{y}/{x}",PurplishBlue:"//map.geoq.cn/ArcGIS/rest/services/ChinaOnlineStreetPurplishBlue/MapServer/tile/{z}/{y}/{x}",Gray:"//map.geoq.cn/ArcGIS/rest/services/ChinaOnlineStreetGray/MapServer/tile/{z}/{y}/{x}",Warm:"//map.geoq.cn/ArcGIS/rest/services/ChinaOnlineStreetWarm/MapServer/tile/{z}/{y}/{x}"},Theme:{Hydro:"//thematic.geoq.cn/arcgis/rest/services/ThematicMaps/WorldHydroMap/MapServer/tile/{z}/{y}/{x}"},Subdomains:[]},OSM:{Normal:{Map:"//{s}.tile.osm.org/{z}/{x}/{y}.png"},Subdomains:["a","b","c"]},Baidu:{Normal:{Map:"//online{s}.map.bdimg.com/onlinelabel/?qt=tile&x={x}&y={y}&z={z}&styles=pl&scaler=1&p=1"},Satellite:{Map:"//shangetu{s}.map.bdimg.com/it/u=x={x};y={y};z={z};v=009;type=sate&fm=46",Annotion:"//online{s}.map.bdimg.com/tile/?qt=tile&x={x}&y={y}&z={z}&styles=sl&v=020"},Subdomains:"0123456789",tms:!0},BaiduV3:{Normal:{Map:"//maponline{s}.bdimg.com/tile/?qt=vtile&x={x}&y={y}&z={z}&styles=pl&scaler=2&udt=&from=jsapi3_0"},Subdomains:"012",tms:!0},Tencent:{Normal:{Map:"//rt{s}.map.gtimg.com/tile?z={z}&x={x}&y={-y}&type=vector&styleid=3"},Satellite:{Map:"//p{s}.map.gtimg.com/sateTiles/{z}/{sx}/{sy}/{x}_{-y}.jpg"},Terrain:{Map:"//p{s}.map.gtimg.com/demTiles/{z}/{sx}/{sy}/{x}_{-y}.jpg"},Subdomains:"0123"},Mapbox:{Satellite:{Map:"//api.mapbox.com/v4/mapbox.satellite/{z}/{x}/{y}.webp?access_token={key}"},Subdomains:"0",key:"pk.eyJ1Ijoib3Nkd2VueXUiLCJhIjoiY2w2b2g2bnllMDFxMzNjcGlwcXNxazRrNyJ9.QBEkrrQwNHRvBy81N5STAw"}},L.tileLayer.chinaProvider=function(e,t){return new L.TileLayer.ChinaProvider(e,t)},L.CoordConver=function(){this.bd09_To_gps84=function(e,t){var r=this.bd09_To_gcj02(e,t);return this.gcj02_To_gps84(r.lng,r.lat)},this.gps84_To_bd09=function(e,t){var r=this.gps84_To_gcj02(e,t);return this.gcj02_To_bd09(r.lng,r.lat)},this.gps84_To_gcj02=function(n,i){var c=o(n-105,i-35),s=a(n-105,i-35),l=i/180*e,u=Math.sin(l);u=1-r*u*u;var p=Math.sqrt(u);return c=180*c/(t*(1-r)/(u*p)*e),{lng:n+(s=180*s/(t/p*Math.cos(l)*e)),lat:i+c}},this.gcj02_To_gps84=function(n,i){var c=function(n,i){var c=o(n-105,i-35),s=a(n-105,i-35),l=i/180*e,u=Math.sin(l);u=1-r*u*u;var p=Math.sqrt(u);return c=180*c/(t*(1-r)/(u*p)*e),s=180*s/(t/p*Math.cos(l)*e),{lng:n+s,lat:i+c}}(n,i);return{lng:2*n-c.lng,lat:2*i-c.lat}},this.gcj02_To_bd09=function(e,t){var r=Math.sqrt(e*e+t*t)+2e-5*Math.sin(t*n),o=Math.atan2(t,e)+3e-6*Math.cos(e*n);return{lng:r*Math.cos(o)+.0065,lat:r*Math.sin(o)+.006}},this.bd09_To_gcj02=function(e,t){var r=e-.0065,o=t-.006,a=Math.sqrt(r*r+o*o)-2e-5*Math.sin(o*n),i=Math.atan2(o,r)-3e-6*Math.cos(r*n);return{lng:a*Math.cos(i),lat:a*Math.sin(i)}};var e=3.141592653589793,t=6378245,r=.006693421622965943,n=3e3*e/180;function o(t,r){var n=2*t-100+3*r+.2*r*r+.1*t*r+.2*Math.sqrt(Math.abs(t));return n+=2*(20*Math.sin(6*t*e)+20*Math.sin(2*t*e))/3,n+=2*(20*Math.sin(r*e)+40*Math.sin(r/3*e))/3,n+=2*(160*Math.sin(r/12*e)+320*Math.sin(r*e/30))/3}function a(t,r){var n=300+t+2*r+.1*t*t+.1*t*r+.1*Math.sqrt(Math.abs(t));return n+=2*(20*Math.sin(6*t*e)+20*Math.sin(2*t*e))/3,n+=2*(20*Math.sin(t*e)+40*Math.sin(t/3*e))/3,n+=2*(150*Math.sin(t/12*e)+300*Math.sin(t/30*e))/3}},L.coordConver=function(){return new L.CoordConver},L.tileLayer.chinaProvider=function(e,t){return(t=t||{}).corrdType=function(e){var t=e.split(".")[0],r="wgs84";switch(t){case"Geoq":case"GaoDe":case"Google":r="gcj02";break;case"Baidu":case"BaiduV3":r="bd09";break;case"OSM":case"TianDiTu":r="wgs84"}return r}(e),new L.TileLayer.ChinaProvider(e,t)},L.GridLayer.include({_setZoomTransform:function(e,t,r){var n=t;null!=n&&this.options&&("gcj02"==this.options.corrdType?n=L.coordConver().gps84_To_gcj02(t.lng,t.lat):"bd09"==this.options.corrdType&&(n=L.coordConver().gps84_To_bd09(t.lng,t.lat)));var o=this._map.getZoomScale(r,e.zoom),a=e.origin.multiplyBy(o).subtract(this._map._getNewPixelOrigin(n,r)).round();L.Browser.any3d?L.DomUtil.setTransform(e.el,a,o):L.DomUtil.setPosition(e.el,a)},_getTiledPixelBounds:function(e){var t=e;null!=t&&this.options&&("gcj02"==this.options.corrdType?t=L.coordConver().gps84_To_gcj02(e.lng,e.lat):"bd09"==this.options.corrdType&&(t=L.coordConver().gps84_To_bd09(e.lng,e.lat)));var r=this._map,n=r._animatingZoom?Math.max(r._animateToZoom,r.getZoom()):r.getZoom(),o=r.getZoomScale(n,this._tileZoom),a=r.project(t,this._tileZoom).floor(),i=r.getSize().divideBy(2*o);return new L.Bounds(a.subtract(i),a.add(i))}});var d={map:{container:"map",type:"GaoDe.Normal.Map",center:[31.8584,117.285],zoom:14,preferCanvas:!0,minZoom:6,maxZoom:18,key:"6cb11577e3ac27bbe015669e413f6cc4"},control:{addAttribution:{enable:!1},zoom:{enable:!0}},autoLocation:!1},f=o.default(),h=null;var v=Object.freeze({__proto__:null,createMap:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,t=e.map;return h=L.map(t.container,c({attributionControl:!1,zoomControl:!1},t)),f.emit("mapLoaded"),h},addPresetTileLayer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,t=e.map,r=L.tileLayer.chinaProvider(t.type,c({},t));return r.addTo(h),f.emit("tileLayerLoaded"),r}});var y=Object.freeze({__proto__:null,attributionControl:function(e){var t=c({prefix:"",content:'leaft-map &copy; <a href="https://www.osdiot.com/">Osdiot</a>'},e),r=L.control.attribution();return r.setPrefix(t.prefix),r.addAttribution(t.content),r},zoomControl:function(e,t){var r=c({},e);return L.control.zoom(r)},scaleControl:function(e,t){var r=c({},e);return L.control.scale(r)}}),m=a.default.create({baseURL:"/api",timeout:1e4});function g(){return(g=u(s().mark((function e(t){var r,n,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=c({service:"WFS",version:"1.1.0",request:"GetFeature",typeName:t.layer,outputFormat:"application/json"},t),n=t.url,o=n+L.Util.getParamString(r,n),e.next=5,m.get(o);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}m.interceptors.request.use((function(e){return e})),m.interceptors.response.use(function(){var e=u(s().mark((function e(t){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.config,200===t.status){e.next=3;break}return e.abrupt("return",Promise.reject(r));case 3:return r=t.data,e.abrupt("return",Promise.resolve(r));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());var w=Object.freeze({__proto__:null,getGeoJson:function(e){return g.apply(this,arguments)},createWFSLayer:function(e,t){return new L.geoJson(t,{style:c(c({},e.style),{},{renderer:L.canvas()}),onEachFeature:function(){}})},createWMSLayer:function(e){var t=c({layers:e.layer,format:"image/png",transparent:!0,crs:L.CRS.EPSG4326},e);e.crs&&(t.crs=e.crs);var r=L.tileLayer.wms(e.url,t);return console.log(r),r},createImgPoint:function(){}}),b="http://api.tianditu.gov.cn";function x(e){return m.get("".concat(b,"/v2/search"),{params:{postStr:JSON.stringify(e),type:"query",tk:e.tk}})}function k(e){return m.get("".concat(b,"/geocoder"),{params:{ds:JSON.stringify(e),tk:e.tk}})}function _(e){return m.get("".concat(b,"/geocoder"),{params:{type:"geocode",postStr:JSON.stringify(e),tk:e.tk}})}function E(){return m.get("https://map.tianditu.gov.cn/data/getCityName")}function T(){return T=u(s().mark((function e(t,r){var n,o,a,i,l,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.getZoom(),o=t.getBounds(),a=o._northEast,i=o._southWest,l=Object.values(i).reverse().concat(Object.values(a).reverse()).join(),r.tk){e.next=5;break}throw new Error("请传入正确的key");case 5:return e.next=7,x(c({level:n,mapBound:l,queryType:1,start:0},r));case 7:return u=e.sent,e.abrupt("return",u);case 9:case"end":return e.stop()}}),e)}))),T.apply(this,arguments)}function M(){return(M=u(s().mark((function e(t){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.tk){e.next=2;break}throw new Error("请传入正确的key");case 2:return e.next=4,k(t);case 4:return r=e.sent,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(){return(j=u(s().mark((function e(t){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.tk){e.next=2;break}throw new Error("请传入正确的key");case 2:return e.next=4,_(c(c({},t),{},{ver:1}));case 4:return r=e.sent,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(){return(S=u(s().mark((function e(t){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E();case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var O,z,D,P,N=Object.freeze({__proto__:null,localSearch:function(e,t){return T.apply(this,arguments)},getLocation:function(e){return M.apply(this,arguments)},getPoint:function(e){return j.apply(this,arguments)},getLocationByIp:function(e){return S.apply(this,arguments)}});L.drawLocal={draw:{toolbar:{actions:{title:"取消绘图",text:""},finish:{title:"完成绘图",text:"Finish"},undo:{title:"删除最后绘制的点",text:""},buttons:{polyline:"绘制一个多段线",polygon:"绘制一个多边形",rectangle:"绘制一个矩形",circle:"绘制一个圆",marker:"绘制一个标记",circlemarker:"绘制一个圆形标记"}},handlers:{circle:{tooltip:{start:"单击并拖动以绘制圆"},radius:"半径"},circlemarker:{tooltip:{start:"单击“地图”以放置圆标记"}},marker:{tooltip:{start:"单击“地图”以放置标记"}},polygon:{tooltip:{start:"单击开始绘制形状",cont:"单击继续绘制形状",end:"单击第一个点关闭此形状"}},polyline:{error:"<strong>错误:</strong>形状边缘不能交叉！",tooltip:{start:"单击开始绘制线",cont:"单击以继续绘制线",end:"双击地图或单击最后一个点结束绘制"}},rectangle:{tooltip:{start:"单击并拖动以绘制矩形"}},simpleshape:{tooltip:{end:"释放鼠标完成绘图"}}}},edit:{toolbar:{actions:{save:{title:"保存更改",text:"保存"},cancel:{title:"取消编辑，放弃所有更改",text:"取消"},clearAll:{title:"清除所有图层",text:"清除所有"}},buttons:{edit:"编辑图层",editDisabled:"无可编辑的图层",remove:"删除图层",removeDisabled:"无可删除的图层"}},handlers:{edit:{tooltip:{text:"拖动控制柄或标记以编辑要素",subtext:"单击“取消”撤消更改"}},remove:{tooltip:{text:"单击要删除的要素"}}}}};var C={},G=null;function A(e){var t=[];e.eachLayer((function(e){t.push(e.getLatLng());var r=t.length<=1?q("起点"):q(F(t));e.bindTooltip(r,{permanent:!0,direction:"right",className:"measure-tooltip"}).openTooltip()})),C[G].point=e}function R(){var e=0,t=[],r=C[G].point;r&&r.eachLayer((function(n){e+=1,t.push(n.getLatLng()),e===Object.keys(r.getLayers()).length&&n.setTooltipContent(q("共"+F(t)+"<div onclick='polyline.remove(\""+G+"\")'>删除</div>"))})),O.addLayer(r)}function q(e){return"<div style='display:block;cursor:pointer;color:#f00'>".concat(e,"</div>")}function F(e){for(var t=0,r=0;r<e.length-1;r++){var n=e[r],o=e[r+1];t+=L.latLng([n.lat,n.lng]).distanceTo([o.lat,o.lng])}return"".concat((t/1e3).toFixed(2),"km")}window.polyline={},window.polyline.remove=function(e){Object.keys(C[e]).forEach((function(t){C[e][t].remove()}))};var I,B,W,U,X={initialize:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{showMarker:!1};O=e,z=new L.FeatureGroup,O.addLayer(z),G=r.nanoid(),C[G]={point:new L.FeatureGroup,shape:new L.FeatureGroup},D=new L.Control.Draw({edit:{featureGroup:z},draw:{polyline:c({icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon measure-icon"}),shapeOptions:{stroke:!0,color:"#f40",weight:4,opacity:1,fill:!1,clickable:!0}},t)}}),O.off(L.Draw.Event.CREATED).on(L.Draw.Event.CREATED,(function(e){e.layer.id=G,C[G].shape=e.layer,z.addLayer(C[G].shape),t.showMarker&&setTimeout((function(){R()}),0),f.emit("measure.polyline.created",e)})),O.off(L.Draw.Event.DRAWVERTEX).on(L.Draw.Event.DRAWVERTEX,(function(e){t.showMarker&&A(e.layers)}))},enable:function(){(P=new L.Draw.Polyline(O,D.options.draw.polyline)).enable()},disable:function(){var e;null===(e=P)||void 0===e||e.disable()},removeAll:function(){Object.keys(C).forEach((function(e){Object.keys(C[e]).forEach((function(t){C[e][t].remove()}))}))}},Z={},V=null;function Y(e){var t,r=L.marker(e[0],{icon:L.divIcon({className:"measure-div-icon"})});r.bindTooltip((t="".concat(function(e){return(L.GeometryUtil.geodesicArea(e)/1e6).toFixed(2)+"k㎡"}(e),"<div onclick=\"polygon.remove('").concat(V,"')\">删除</div>"),"<div style='display:block;cursor:pointer;color:#f00'>".concat(t,"</div>")),{permanent:!0,direction:"right",className:"measure-tooltip"}).openTooltip(),Z[V].point.addLayer(r),Z[V].point.addTo(I)}window.polygon={},window.polygon.remove=function(e){Object.keys(Z[e]).forEach((function(t){Z[e][t].remove()}))};var J,H,Q,K,$={initialize:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{showMarker:!1};I=e,B=new L.FeatureGroup,I.addLayer(B),V=r.nanoid(),Z[V]={point:new L.FeatureGroup,shape:new L.FeatureGroup},W=new L.Control.Draw({edit:{featureGroup:B},draw:{polygon:c({icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon measure-icon"}),shapeOptions:{stroke:!0,color:"#f40",weight:4,opacity:1}},t)}}),I.off(L.Draw.Event.CREATED).on(L.Draw.Event.CREATED,(function(e){e.layer.id=V,Z[V].shape=e.layer,B.addLayer(Z[V].shape);var r=Z[V].shape.getLatLngs()[0];t.showMarker&&Y(r),f.emit("measure.polygon.created",e)})),I.off(L.Draw.Event.DRAWVERTEX)},enable:function(){(U=new L.Draw.Polygon(I,W.options.draw.polygon)).enable()},disable:function(){var e;null===(e=U)||void 0===e||e.disable()},removeAll:function(){Object.keys(Z).forEach((function(e){Object.keys(Z[e]).forEach((function(t){Z[e][t].remove()}))}))}},ee={},te=null;function re(e,t){var r,n=L.marker(t,{icon:L.divIcon({className:"measure-div-icon"})});n.bindTooltip((r="".concat(function(e){return(Math.PI*Math.pow(e/1e3,2)).toFixed(2)+"k㎡"}(e),"<div onclick=\"circle.remove('").concat(te,"')\">删除</div>"),"<div style='display:block;cursor:pointer;color:#f00'>".concat(r,"</div>")),{permanent:!0,direction:"right",className:"measure-tooltip"}).openTooltip(),ee[te].point.addLayer(n),ee[te].point.addTo(J)}window.circle={},window.circle.remove=function(e){Object.keys(ee[e]).forEach((function(t){ee[e][t].remove()}))};var ne,oe,ae,ie,ce={initialize:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{showMarker:!1};J=e,H=new L.FeatureGroup,J.addLayer(H),te=r.nanoid(),ee[te]={point:new L.FeatureGroup,shape:new L.FeatureGroup},Q=new L.Control.Draw({edit:{featureGroup:H},draw:{circle:c({icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon measure-icon"}),shapeOptions:{stroke:!0,color:"#f40",weight:4,opacity:1}},t)}}),J.off(L.Draw.Event.CREATED).on(L.Draw.Event.CREATED,(function(e){e.layer.id=te,ee[te].shape=e.layer,H.addLayer(ee[te].shape),t.showMarker&&re(e.layer.getRadius(),e.layer.getLatLng()),f.emit("measure.circle.created",e)})),J.off(L.Draw.Event.DRAWVERTEX)},enable:function(){(K=new L.Draw.Circle(J,Q.options.draw.circle)).enable()},disable:function(){var e;null===(e=K)||void 0===e||e.disable()},removeAll:function(){Object.keys(ee).forEach((function(e){Object.keys(ee[e]).forEach((function(t){ee[e][t].remove()}))}))}},se={},le=null;function ue(e,t){var r,n=L.marker(t,{icon:L.divIcon({className:"measure-div-icon"})});n.bindTooltip((r="".concat(function(e){return(L.GeometryUtil.geodesicArea(e)/1e6).toFixed(2)+"k㎡"}(e),"<div onclick=\"rectangle.remove('").concat(le,"')\">删除</div>"),"<div style='display:block;cursor:pointer;color:#f00'>".concat(r,"</div>")),{permanent:!0,direction:"right",className:"measure-tooltip"}).openTooltip(),se[le].point.addLayer(n),se[le].point.addTo(ne)}window.rectangle={},window.rectangle.remove=function(e){Object.keys(se[e]).forEach((function(t){se[e][t].remove()}))};var pe={initialize:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{showMarker:!1};ne=e,oe=new L.FeatureGroup,ne.addLayer(oe),le=r.nanoid(),se[le]={point:new L.FeatureGroup,shape:new L.FeatureGroup},ae=new L.Control.Draw({edit:{featureGroup:oe},draw:{rectangle:c({icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon measure-icon"}),shapeOptions:{stroke:!0,color:"#f40",weight:4,opacity:1},showArea:!1},t)}}),ne.off(L.Draw.Event.CREATED).on(L.Draw.Event.CREATED,(function(e){e.layer.id=le,se[le].shape=e.layer,oe.addLayer(se[le].shape);var r=se[le].shape.getLatLngs()[0];t.showMarker&&ue(r,se[le].shape.getCenter()),f.emit("measure.rectangle.created",e)})),ne.off(L.Draw.Event.DRAWVERTEX)},enable:function(){(ie=new L.Draw.Rectangle(ne,ae.options.draw.rectangle)).enable()},disable:function(){var e;null===(e=ie)||void 0===e||e.disable()},removeAll:function(){Object.keys(se).forEach((function(e){Object.keys(se[e]).forEach((function(t){se[e][t].remove()}))}))}},de=Object.freeze({__proto__:null,polyline:X,polygon:$,circle:ce,rectangle:pe}),fe={timeout:3e3,enableHighAccuracy:!1};var he={getLocation:function(e){var t=c(c({},fe),e),r=t.timeout,n=t.enableHighAccuracy;return new Promise((function(e,t){if(navigator.geolocation)var o=navigator.geolocation.watchPosition((function(t){var r=t.coords,n=r.latitude,a=r.longitude;navigator.geolocation.clearWatch(o),e({latitude:n,longitude:a})}),(function(e){switch(navigator.geolocation.clearWatch(o),e.code){case e.PERMISSION_DENIED:t("html5已拒绝定位");break;case e.POSITION_UNAVAILABLE:t("html5位置信息不可用");break;case e.TIMEOUT:t("html5定位超时");break;case e.UNKNOWN_ERROR:t("html5定位未知错误")}}),{enableHighAccuracy:n,timeout:r,maximumAge:0});else t("浏览器不支持HTML5定位")}))}};var ve={createScript:function(e,t,r){var n=document.createElement("script");n.type="text/javascript",n.src=e,n.onerror=t,n.onload=r,document.head.appendChild(n)},createStyle:function(e){var t=document.getElementsByTagName("head")[0],r=document.createElement("link");r.type="text/css",r.rel="stylesheet",r.href=e,t.appendChild(r)}},ye=Object.freeze({__proto__:null,location:he,loadAssets:ve,emitter:f}),me=c(c({},v),{},{control:y,layer:w,service:N,measure:de});exports.map=me,exports.utils=ye;
