/*! TestGrunt 2019-11-05 */
function setLoadEdit(a){for(var b=0,c=loadPlotShapeArr.length;c>b;b++)if(loadPlotShapeArr[b].isEdit=a,!a){try{loadPlotShapeArr[b].edit?loadPlotShapeArr[b].edit.removeHooks(!0):loadPlotShapeArr[b].removeHooks()}catch(d){}loadPlotShapeArr[b].deleteMarker&&mapObj.map.removeLayer(loadPlotShapeArr[b].deleteMarker),loadPlotShapeArr[b].isClickListener=!1}}function setMarkerImgPtStyle(a,b){if(-1!=a.options.icon.options.iconUrl.indexOf(plotingUI))var c=Aqsc.Util.getBaseImgPath(),d=L.icon({iconUrl:c.substring(0,c.length-7)+"plotingUI/"+b.style.iconUrl,iconSize:[b.style.iconSize0,b.style.iconSize1],iconAnchor:[b.style.iconAnchor0,b.style.iconAnchor1]});else var d=L.icon({iconUrl:b.style.iconUrl,iconSize:[b.style.iconSize0,b.style.iconSize1],iconAnchor:[b.style.iconAnchor0,b.style.iconAnchor1]});if(b.style.amination){a.isPluse=!0;try{a.pluse?a.pluse._map.removeLayer(a.pluse):null}catch(e){}finally{var f=L.icon.pulse({iconSize:[b.style.iconSize0,b.style.iconSize1],iconAnchor:[b.style.iconAnchor0,b.style.iconAnchor1],color:b.style.aminationColor});a.pluse=L.marker([a._latlng.lat,a._latlng.lng],{icon:f}),a.pluse.addTo(_MAP)}}else try{a.isPluse=!1,a.pluse?a.pluse._map.removeLayer(a.pluse):null}catch(e){}a.setIcon(d),a.setOpacity(b.style.opacity)}function setMarkerIconPtStyle(a,b){if(a.setOpacity(b.style.opacity),a.options.icon.setColor(b.style.color),a.options.icon.options.iconColor=b.style.color,a.options.icon.setFontSize(b.style.size+"px"),a.options.icon.options.fontSize=b.style.size+"px",b.style.amination){a.isPluse=!0;try{a.pluse?a.pluse._map.removeLayer(a.pluse):null}catch(c){}finally{var d=L.icon.pulse({iconSize:[parseInt(b.style.size),parseInt(b.style.size)],iconAnchor:[7,32],color:b.style.aminationColor});a.pluse=L.marker([a._latlng.lat,a._latlng.lng],{icon:d}),a.pluse.addTo(_MAP)}}else try{a.isPluse=!1,a.pluse?a.pluse._map.removeLayer(a.pluse):null}catch(c){}}var mapObj=null,geoJsonArr=null,tempSourceShape=null,tempShape=null,plotOperate=null,loadPlotShape=null,loadPlotShapeArr=[],loadGeoJson=[],loadLayers=[],setMarkerImgs=[],addMarkerImgs=[],setImgs=[],addImgs=[],setMarkerIcons=[],addMarkerIcons=[],setCommonPlot=[],isPlotEdit=!0;Aqsc.PlotingT=Aqsc.Plot.extend({initialize:function(a,b,c){switch(Aqsc.Plot.prototype.initialize.apply(this,arguments),this.shape=c.shape,b){case"polyline":this.edit=new L.Edit.Poly(this.shape);break;case"polygon":this.edit=new L.Edit.PolyVerticesEdit(this.shape,this.shape.getLatLngs());break;case"circle":this.edit=new L.Edit.Circle(this.shape);break;case"rectangle":this.edit=new L.Edit.Rectangle(this.shape);break;case"markerImgPt":case"markerIconPt":this.edit=new L.Edit.Marker(this.shape)}}}),Aqsc.PlotingText=Aqsc.PlotMarkerName.extend({initialize:function(a,b){Aqsc.Plot.prototype.initialize.apply(this,arguments),this.shape=b.shape,this.txt=b.shape}}),Aqsc.PlotingImg=Aqsc.PlotImg.extend({initialize:function(a,b){if(Aqsc.Plot.prototype.initialize.apply(this,arguments),this.shape=b.shape,this.draggable=b.draggable,b.draggable){var c=Aqsc.Util.getBaseImgPath(),d=L.icon({iconUrl:c+"rect.png",iconSize:[16,16]}),e=L.icon({iconUrl:c+"rotate.png",iconSize:[25,25]});this.imageOverlayRotateMarkerNW=L.marker(b.point1,{draggable:this.draggable,opacity:0,icon:e}).addTo(a.map),this.imageOverlayRotateMarkerNE=L.marker(b.point2,{draggable:this.draggable,opacity:0,icon:d}).addTo(a.map),this.imageOverlayRotateMarkerSW=L.marker(b.point3,{draggable:this.draggable,opacity:0,icon:d}).addTo(a.map)}}}),Aqsc.PlotingUI=function(){this.initialize.apply(this,arguments)},Aqsc.PlotingUI.prototype={options:{title:"标绘",width:"240px",height:"600px",skin:"layui-layer-qianlan",content:"../libs/aqsc/plotingUI/plotingUI.html",maxmin:!0,offset:"rt",minTop:"10px",minLeft:"87%",tpd:!0,ztd:!0,xm:!0,tp:!0,jb:!0,closeBtn:0},initialize:function(a,b,c){c=c||{},L.setOptions(this,c),this.options.content=b,this.map=a,mapObj=a,plotOperate=new PlotOperate(a),plotOperate.tpd=this.options.tpd,plotOperate.ztd=this.options.ztd,plotOperate.xm=this.options.xm,plotOperate.tp=this.options.tp,plotOperate.jb=this.options.jb},open:function(){var a=this;a.layerIndex=layer.open({id:"plotingUI",skin:a.options.skin,type:2,title:a.options.title,shadeClose:!0,closeBtn:a.options.closeBtn,shade:!1,area:[a.options.width,this.options.height],offset:a.options.offset,content:a.options.content,maxmin:!0,min:function(b){$(b).find(".layui-layer-max").show(),setTimeout(function(){b.css({top:a.options.minTop,left:a.options.minLeft})},0)},restore:function(a){$(a).find(".layui-layer-max").hide()},success:function(b){$(b).find(".layui-layer-max").hide();var c=document.getElementById("plotingUI").getElementsByTagName("iframe")[0].contentWindow;a.options.onSaved&&(c.document.getElementById("btn_plot_savefile").onclick=function(b){b.geojson=geoJsonArr,a.options.onSaved(b)}),a.options.onDeleted&&(c.document.getElementById("btn_plot_delall").onclick=function(b){b.geojson=geoJsonArr,a.options.onDeleted(b)}),a.options.onLoaded&&(c.document.getElementById("btn_plot_openfile").onclick=function(b){b.geojson=geoJsonArr,a.options.onLoaded(b)}),a.options.onLoadOvered&&(c.document.getElementById("btn_plot_openfile2").onclick=function(b){b.geojson=geoJsonArr,a.options.onLoadOvered(b)})}})},close:function(){plotOperate=null,layer.close(this.layerIndex)},onSaved:function(a){var b=this._getIframe();b.attachEvent?b.attachEvent("onreadystatechange",function(){("complete"===b.readyState||"loaded"==b.readyState)&&(b.document.getElementById("btn_plot_savefile").onclick=function(b){setTimeout(function(){b.geojson=geoJsonArr,a(b)},10)})}):b.addEventListener("load",function(){b.document.getElementById("btn_plot_savefile").onclick=function(b){setTimeout(function(){b.geojson=geoJsonArr,a(b)},10)}},!0)},onDeleted:function(a){var b=this._getIframe();b.attachEvent?b.attachEvent("onreadystatechange",function(){("complete"===b.readyState||"loaded"==b.readyState)&&(b.document.getElementById("btn_plot_delall").onclick=function(b){setTimeout(function(){b.geojson=geoJsonArr,a(b)},10)})}):b.addEventListener("load",function(){b.document.getElementById("btn_plot_delall").onclick=function(b){setTimeout(function(){b.geojson=geoJsonArr,a(b)},10)}},!0)},_getIframe:function(){setTimeout(function(){},200);var a=(document.getElementById("plotingUI").getElementsByTagName("iframe")[0].id,document.getElementById("plotingUI").getElementsByTagName("iframe")[0].contentWindow);return a},_on:function(a,b,c){var d=this._getIframe();d.attachEvent?d.attachEvent("onreadystatechange",function(){("complete"===d.readyState||"loaded"==d.readyState)&&(d.document.getElementById(b).onclick=function(b){a(c?c:b)})}):d.addEventListener("load",function(){d.document.getElementById(b).onclick=function(b){a(c?c:b)}},!0)},onLoaded:function(a){this._on(a,"btn_plot_openfile")},load:function(a){var b=this,c=a;setTimeout(function(){b._plotGeoJsonToMap(b.map,c)},20)},onLoadOvered:function(a){this._on(a,"btn_plot_openfile2")},loadOverd:function(a){this._plotGeoJsonToMap(this.map,a)},setCommonPlot:function(a){setCommonPlot=a},setMarkerImgs:function(a){setMarkerImgs=a},addMarkerImgs:function(a){addMarkerImgs=a},getMarkerImgs:function(){},setMarkerIcons:function(a){setMarkerIcons=a},addMarkerIcons:function(a){addMarkerIcons=a},getMarkerIcon:function(){},setImgs:function(a){setImgs=a},addImgs:function(a){addImgs=a},setSelectOptions:function(a){void 0!=a.tpd&&(plotOperate.tpd=a.tpd),void 0!=a.ztd&&(plotOperate.ztd=a.ztd),void 0!=a.xm&&(plotOperate.xm=a.xm),void 0!=a.tp&&(plotOperate.tp=a.tp),void 0!=a.jb&&(plotOperate.jb=a.jb)},getImgs:function(){},pl:null,pg:null,rec:null,cir:null,mImgPt:null,mIconPt:null,mNamePt:null,_getImageRelativePath:function(a,b){for(var c=a.split("/"),d=0,e=[],f=0;f<c.length;f++)if(c[f]==b){d=f;break}for(var g=d+1,h=0;g<c.length;g++)e[h++]=c[g];return e=e.join("/")},_plotGeoJsonToMap:function(a,b){for(var c=[],d=[],e=null,f="",g="",h="",i=null,j=null,k=this,l=0,m=b.features.length;m>l;l++)switch(b.features[l].features?(g=b.features[l].features[0].properties.type,h=b.features[l].features[0].properties.plotType):(f=b.features[l].crs?b.features[l].crs.properties.name:"wgs84",g=b.features[l].properties.type,j=b.features[l].properties.attr,i=b.features[l].properties.style,i.renderer=L.svg()),g){case"markerImgPt":case"markerIconPt":case"markerNamePt":case"circle":if(c=b.features[l].geometry.coordinates,d=Aqsc.Util.transProjToMapProj(c[0],c[1],a.type,f),"circle"==g||"markerNamePt"==g)if(e=b.features[l].properties.style,"circle"==g){var n=L.circle([d[1],d[0]],i).addTo(a.map);k.cir=new Aqsc.PlotingT(a,"circle",{shape:n,isEdit:isPlotEdit}),k.cir._edit(k.cir),loadGeoJson.push(n.toGeoJSON()),n.type=g,loadLayers.push(n),loadPlotShapeArr.push(k.cir),n.on("click",function(b){tempShape=null,loadPlotShape=new Aqsc.PlotingT(a,"circle",{shape:b.sourceTarget,isEdit:isPlotEdit});var c={name:"圆",type:"circle",type1:"load",style:b.sourceTarget.options,attr:j.name?j:{name:"",remark:""},shapeEdit:!0};c.style.radius=Math.round(n._radius);var d=document.getElementById("plotingUI").getElementsByTagName("iframe")[0].id;c.shapeEdit=isPlotEdit,$("#"+d)[0].contentWindow.plotEdit.startEditing(c,[b.sourceTarget._latlng])})}else{var o=L.text([d[1],d[0]],b.features[l].properties.text,e).addTo(a.map);k.mNamePt=new Aqsc.PlotingText(a,{shape:o,isEdit:!0}),k.mNamePt._edit(k.mNamePt),loadGeoJson.push(o.toGeoJSON()),o.type=g,loadLayers.push(o),loadPlotShapeArr.push(k.mNamePt),o.on("click",function(b){tempShape=null,loadPlotShape=new Aqsc.PlotingText(a,{shape:b.sourceTarget,isEdit:isPlotEdit});var c={color:b.sourceTarget.options.color,font_family:b.sourceTarget.options.fontFamily,font_size:b.sourceTarget.options.fontSize,font_style:b.sourceTarget.options.fontStyle,font_weight:b.sourceTarget.options.fontWeight,opacity:b.sourceTarget.options.fillOpacity,text:b.sourceTarget._text},d={name:"文字",type:"text",type1:"load",style:c,attr:j.name?j:{name:"",remark:""},shapeEdit:!0},e=document.getElementById("plotingUI").getElementsByTagName("iframe")[0].id;d.shapeEdit=isPlotEdit,$("#"+e)[0].contentWindow.plotEdit.startEditing(d,[b.sourceTarget._latlng])})}else{e=b.features[l].properties.style.icon.options;var p=null,q=null;if("markerImgPt"==g){p=L.marker([d[1],d[0]],{icon:L.icon(e),opacity:i.opacity?i.opacity:1}).addTo(a.map),p.amination=b.features[l].properties.pluse?!0:!1,p.aminationColor=b.features[l].properties.pluse?b.features[l].properties.pluse:"red";var r=L.icon.pulse({iconSize:e.iconSize?e.iconSize:[36,44],iconAnchor:e.iconAnchor?e.iconAnchor:[16,44],color:p.aminationColor});p.pluse=L.marker([d[1],d[0]],{icon:r}),p.amination&&p.pluse.addTo(a.map),k.mImgPt=new Aqsc.PlotingT(a,"markerImgPt",{shape:p,isEdit:isPlotEdit}),k.mImgPt._edit(k.mImgPt),loadPlotShapeArr.push(k.mImgPt),p.type=g;var s="";s=-1!=e.iconUrl.indexOf("plotingUI")?k._getImageRelativePath(e.iconUrl,"plotingUI"):e.iconUrl,p.on("click",function(b){tempShape=null,loadPlotShape=new Aqsc.PlotingT(a,"markerImgPt",{shape:b.sourceTarget,isEdit:isPlotEdit}),loadPlotShape.shape.pluse?b.sourceTarget.amination=void 0==loadPlotShape.shape.isPluse||loadPlotShape.shape.isPluse?!0:!1:loadPlotShape.shape.pluse=b.sourceTarget.pluse,q={amination:b.sourceTarget.amination,aminationColor:b.sourceTarget.aminationColor,iconAnchor0:b.sourceTarget.options.icon.options.iconAnchor[0],iconAnchor1:b.sourceTarget.options.icon.options.iconAnchor[1],iconSize0:b.sourceTarget.options.icon.options.iconSize[0],iconSize1:b.sourceTarget.options.icon.options.iconSize[1],iconUrl:b.sourceTarget.options.icon.options.iconUrl,opacity:b.sourceTarget.options.opacity?b.sourceTarget.options.opacity:1};var c={name:"图片点",type:"marker",type1:"load",style:q,attr:j.name?j:{name:"",remark:""},shapeEdit:!0},d=document.getElementById("plotingUI").getElementsByTagName("iframe")[0].id;c.shapeEdit=isPlotEdit,$("#"+d)[0].contentWindow.plotEdit.startEditing(c,[b.sourceTarget._latlng])})}else{p=L.marker([d[1],d[0]],{icon:L.AwesomeMarkers.iconOnly(e)}).addTo(a.map),p.amination=b.features[l].properties.pluse?!0:!1,p.aminationColor=b.features[l].properties.pluse?b.features[l].properties.pluse:"red",k.mIconPt=new Aqsc.PlotingT(a,"markerIconPt",{shape:p,isEdit:isPlotEdit}),k.mIconPt._edit(k.mIconPt);var r=L.icon.pulse({iconSize:e.fontSize?[parseInt(e.fontSize),parseInt(e.fontSize)]:[36,44],iconAnchor:e.iconAnchor?e.iconAnchor:[16,32],color:p.aminationColor});p.pluse=L.marker([d[1],d[0]],{icon:r}),p.amination&&p.pluse.addTo(a.map),loadPlotShapeArr.push(k.mIconPt),p.type=g,p.on("click",function(b){tempShape=null,loadPlotShape=new Aqsc.PlotingT(a,"markerIconPt",{shape:b.sourceTarget,isEdit:isPlotEdit}),loadPlotShape.shape.pluse?void 0==loadPlotShape.shape.isPluse||loadPlotShape.shape.isPluse?b.sourceTarget.pluse:b.sourceTarget.pluse:loadPlotShape.shape.pluse=b.sourceTarget.pluse,q={amination:b.sourceTarget.amination,aminationColor:b.sourceTarget.aminationColor,color:b.sourceTarget.options.icon.options.iconColor,iconClass:b.sourceTarget.options.icon.options.prefix+b.sourceTarget.options.icon.options.icon,opacity:b.sourceTarget.options.opacity?b.sourceTarget.options.opacity:1,size:parseInt(b.sourceTarget.options.icon.options.fontSize)};var c={name:"字体点标记",type:"font-marker",type1:"load",style:q,attr:j.name?j:{name:"",remark:""},shapeEdit:!0},d=document.getElementById("plotingUI").getElementsByTagName("iframe")[0].id;c.shapeEdit=isPlotEdit,$("#"+d)[0].contentWindow.plotEdit.startEditing(c,[b.sourceTarget._latlng])})}loadGeoJson.push(p.toGeoJSON()),loadLayers.push(p),b.features[l].properties.style.text&&L.circle([d[1],d[0]],{text:b.features[l].properties.style.text.text,radius:b.features[l].properties.style.text.radius,fillOpacity:b.features[l].properties.style.text.fillOpacity,opacity:b.features[l].properties.style.text.opacity,textStyle:b.features[l].properties.style.text.textStyle}).addTo(a.map)}break;case"polyline":d=[],c=b.features[l].geometry.coordinates,e=b.features[l].properties.style;for(var t=0,u=c.length;u>t;t++){var v=Aqsc.Util.transProjToMapProj(c[t][0],c[t][1],a.type,f);d.push([v[1],v[0]])}var w=L.polyline(d,e).addTo(a.map);k.pl=new Aqsc.PlotingT(a,"polyline",{shape:w,isEdit:isPlotEdit}),k.pl._edit(k.pl),loadGeoJson.push(w.toGeoJSON()),w.type=g,loadLayers.push(w),loadPlotShapeArr.push(k.pl),void 0==i.weight&&(i.weight=3),void 0==i.opacity&&(i.opacity=1),w.on("click",function(b){tempShape=null,loadPlotShape=new Aqsc.PlotingT(a,"polyline",{shape:b.sourceTarget,isEdit:isPlotEdit});var c={name:"线",type:"polyline",type1:"load",style:b.sourceTarget.options,attr:j.name?j:{name:"",remark:""},shapeEdit:!0},d=document.getElementById("plotingUI").getElementsByTagName("iframe")[0].id;c.shapeEdit=isPlotEdit,$("#"+d)[0].contentWindow.plotEdit.startEditing(c,b.sourceTarget._latlngs)});break;case"polygon":case"rectangle":case"militaryPlot":d=[];var x=null,y=!1,z=[],A=!1;if("polygon"==g||"militaryPlot"==g){if("djt"==h){var B=[];b.features[l].features[0].properties.editVertexs&&(y=!0,A=!0,h=b.features[l].features[0].properties.plotType,z=b.features[l].features[0].properties.editVertexs,f=b.features[l].features[0].crs.properties.name,j=b.features[l].features[0].properties.attr,i=b.features[l].features[0].properties.style,i.renderer=L.svg()),c=b.features[l].features[0].geometry.coordinates;for(var t=0,u=c.length;u>t;t++){var v=Aqsc.Util.transProjToMapProj(c[t][0],c[t][1],a.type,f);B.push(new Aqsc.Point(v[0],v[1]))}var C=new Aqsc.MilitaryPlot(a,"djt",{isEdit:isPlotEdit,style:i});C.enabled=!1,C.points_xy=B,C._calculateParts(C),x=C.movePolygon.polyline,loadGeoJson.push(x.toGeoJSON()),loadLayers.push(C.shape)}else{b.features[l].properties.editVertexs&&(y=!0,h=b.features[l].properties.plotType,z=b.features[l].properties.editVertexs),c=b.features[l].geometry.coordinates;for(var t=0,u=c.length;u>t;t++)for(var D=c[t],E=0,F=D.length;F>E;E++){var v=Aqsc.Util.transProjToMapProj(D[E][0],D[E][1],a.type,f);d.push([v[1],v[0]])}x=L.polygon(d,i).addTo(a.map),loadGeoJson.push(x.toGeoJSON()),loadLayers.push(x)}var G=null;y?(x.editVertexs=z,x.type=g,x.plotType=h,setTimeout(function(){x.setStyle(i)},10),x.on("click",function(b){if(tempShape=null,isPlotEdit){if(loadPlotShape)if(loadPlotShape.edit)try{loadPlotShape.edit.removeHooks(!0)}catch(c){}else try{loadPlotShape.removeHooks()}catch(b){}loadPlotShape=new Aqsc.MilitaryTxEdit(a,b.sourceTarget,{type:h,editSize:new Aqsc.Size(15,15)}),loadPlotShape.initMarkers(),b.sourceTarget.loadPlotShape=loadPlotShape,loadPlotShapeArr.push(loadPlotShape),b.sourceTarget.loadPlotShape.isClickListener=!0,b.sourceTarget.loadPlotShape.editMouseout=!1,b.sourceTarget.addEventListener("mouseout",function(){a.addEventListener("click",function(){if(a.sourceTarget.loadPlotShape.editMouseout){try{a.sourceTarget.loadPlotShape.removeHooks()}catch(a){}a.sourceTarget.loadPlotShape.isClickListener=!1}}),b.sourceTarget.loadPlotShape.editMouseout=!0}),b.sourceTarget.addEventListener("mouseover",function(){b.sourceTarget.loadPlotShape.editMouseout=!1})}plotTypeInObj=A?"polyline":"militaryPlot",G={name:"标绘",type:plotTypeInObj,type1:"load",style:b.sourceTarget.options,attr:j.name?j:{name:"",remark:""},shapeEdit:!0};var d=document.getElementById("plotingUI").getElementsByTagName("iframe")[0].id;G.shapeEdit=isPlotEdit,$("#"+d)[0].contentWindow.plotEdit.startEditing(G,b.sourceTarget._latlngs[0])})):(k.pg=new Aqsc.PlotingT(a,"polygon",{shape:x,isEdit:isPlotEdit}),k.pg._edit(k.pg),loadPlotShapeArr.push(k.pg),x.type=g,x.on("click",function(b){tempShape=null,loadPlotShape=new Aqsc.PlotingT(a,"polygon",{shape:b.sourceTarget,isEdit:isPlotEdit}),G={name:"面",type:"polygon",type1:"load",style:b.sourceTarget.options,attr:j.name?j:{name:"",remark:""},shapeEdit:!0};var c=document.getElementById("plotingUI").getElementsByTagName("iframe")[0].id;G.shapeEdit=isPlotEdit,$("#"+c)[0].contentWindow.plotEdit.startEditing(G,b.sourceTarget._latlngs[0])}))}else{c=b.features[l].geometry.coordinates;var H=Aqsc.Util.transProjToMapProj(c[0][0][0],c[0][0][1],a.type,f),I=Aqsc.Util.transProjToMapProj(c[0][2][0],c[0][2][1],a.type,f),J=L.rectangle([[H[1],H[0]],[I[1],I[0]]],i).addTo(a.map);k.rec=new Aqsc.PlotingT(a,"rectangle",{shape:J,isEdit:isPlotEdit}),k.rec._edit(this.rec),loadGeoJson.push(J.toGeoJSON()),J.type=g,loadLayers.push(J),loadPlotShapeArr.push(k.rec),J.on("click",function(b){tempShape=null,loadPlotShape=new Aqsc.PlotingT(a,"rectangle",{shape:J,isEdit:isPlotEdit});var c={name:"矩形",type:"rectangle",type1:"load",style:b.sourceTarget.options,attr:j.name?j:{name:"",remark:""},shapeEdit:!0},d=document.getElementById("plotingUI").getElementsByTagName("iframe")[0].id;c.shapeEdit=isPlotEdit,$("#"+d)[0].contentWindow.plotEdit.startEditing(c,b.sourceTarget._latlngs[0])})}break;case"img":var K=[];c=b.features[l].geometry.coordinates[0];for(var M=0;M<c.length;M++)d=Aqsc.Util.transProjToMapProj(c[M][0],c[M][1],a.type,f),K.push(d);var N=Aqsc.Util.transProjToMapProj(b.features[l].bbox._southWest.lng,b.features[l].bbox._southWest.lat,a.type,f),O=Aqsc.Util.transProjToMapProj(b.features[l].bbox._northEast.lng,b.features[l].bbox._northEast.lat,a.type,f),P=(L.latLngBounds([[N[1],N[0]],[O[1],O[0]]]),[K[0][1],K[0][0]]),Q=[K[1][1],K[1][0]],R=[K[2][1],K[2][0]],S=i.opacity;i.opacity=1;var T=L.imageOverlay.rotated(b.features[l].properties.url,P,Q,R,i).addTo(a.map);T.setOpacity(S),loadGeoJson.push(T.toGeoJSON()),T.type=g,loadLayers.push(T);var U=b.features[l].properties.url,s=k._getImageRelativePath(U,"plotingUI");k.img=new Aqsc.PlotingImg(a,{draggable:!0,shape:T,point1:P,point2:Q,point3:R,isEdit:isPlotEdit}),k.img._edit(k.img),loadPlotShapeArr.push(k.img),T.on("click",function(a){tempShape=null,loadPlotShape=a.sourceTarget;var b={name:"图片",type:"image",type1:"load",style:{iconUrl:a.sourceTarget._url,opacity:a.sourceTarget.options.opacity?a.sourceTarget.options.opacity:1},attr:j.name?j:{name:"",remark:""},shapeEdit:!0},c=document.getElementById("plotingUI").getElementsByTagName("iframe")[0].id;b.shapeEdit=isPlotEdit,$("#"+c)[0].contentWindow.plotEdit.startEditing(b,[a.sourceTarget._bottomLeft,a.sourceTarget._topLeft,a.sourceTarget._topRight])})}},toGeoJSON:function(){}};var PlotOperate=function(){this.initialize.apply(this,arguments)};PlotOperate.prototype={initialize:function(a){this.map=a,this.plotMpt=null,this.plotIpt=null,this.plotName=null,this.plotX=null,this.plotM=null,this.plotY=null,this.plotJ=null,this.plotImg=null,this.wjt=null,this.zwjt=null,this.djt=null,this.zjt=null,this.sjt=null,this.jhq=null,this.qxqz=null,this.jxqz=null,this.sjqz=null,this.shapeEdit=!0,this.drawLayers=[]},_getGeoJson:function(){var a=[],b=[];a.push.apply(a,this.drawLayers),a.push.apply(a,loadLayers);for(var c=0,d=a.length;d>c;c++)if(a[c]._map||a[c]._layers){var e=a[c].toGeoJSON();b.push(e)}return b.length>0?geoJsonArr=Aqsc.Util.mergeGeoJsons(b):void 0},_deleteAll:function(){this._getGeoJson();for(var a=0,b=this.drawLayers.length;b>a;a++){if(this.drawLayers[a]._layers)for(var c in this.drawLayers[a]._layers)this.map.map.removeLayer(this.drawLayers[a]._layers[c]);this.map.map.removeLayer(this.drawLayers[a])}for(a=0,b=loadLayers.length;b>a;a++){if(loadLayers[a]._layers)for(var c in loadLayers[a]._layers)this.map.map.removeLayer(loadLayers[a]._layers[c]);this.map.map.removeLayer(loadLayers[a])}for(a=document.getElementsByClassName("aqsc-pulsing-icon").length-1;a>=0;a--){var d=document.getElementsByClassName("aqsc-pulsing-icon")[a];d.parentNode.removeChild(d)}a=null,this.drawLayers=[],this.jsonArr=null,loadLayers=[],loadGeoJson=[]},setEditAll:function(a){for(var b=0,c=this.plotOperateArr.length-1;c>b;b++)switch(this.plotOperateArr[b].plotType){case"markerImg":case"markerIcon":case"markerName":case"polyline":case"polygon":case"rectangle":case"circle":if(this.plotOperateArr[b].isEdit=a,!a)try{this.plotOperateArr[b].edit?this.plotOperateArr[b].edit.removeHooks():null,this.map.map.removeLayer(this.plotOperateArr[b].deleteMarker),this.plotOperateArr[b].isClickListener=!1}catch(d){}break;case"wjt":case"zwjt":case"djt":case"zjt":case"sjt":case"jhq":case"qxqz":case"jxqz":case"sjqz":if(this.plotOperateArr[b].isEdit=a,!a)try{this.plotOperateArr[b].edit.removeHooks(),this.plotOperateArr[b].isClickListener=!1}catch(d){}}},setEdit:function(a){if(this.shapeEdit=a,this.plotX&&(this.plotX.isEdit=a,!a))try{this.plotX.edit?this.plotX.edit.removeHooks(!0):null,this.map.map.removeLayer(this.plotX.deleteMarker),this.plotX.isClickListener=!1}catch(b){}if(this.plotM&&(this.plotM.isEdit=a,!a))try{this.plotM.edit?this.plotM.edit.removeHooks(!0):null,this.map.map.removeLayer(this.plotM.deleteMarker),this.plotM.isClickListener=!1}catch(b){}if(this.plotY&&(this.plotY.isEdit=a,!a))try{this.plotY.edit?this.plotY.edit.removeHooks(!0):null,this.map.map.removeLayer(this.plotY.deleteMarker),this.plotY.isClickListener=!1}catch(b){}if(this.plotJ&&(this.plotJ.isEdit=a,!a))try{this.plotJ.edit?this.plotJ.edit.removeHooks(!0):null,this.map.map.removeLayer(this.plotJ.deleteMarker),this.plotJ.isClickListener=!1}catch(b){}if(this.plotMpt&&(this.plotMpt.isEdit=a,!a))try{this.plotMpt.edit?this.plotMpt.edit.removeHooks():null,this.map.map.removeLayer(this.plotMpt.deleteMarker),this.plotMpt.isClickListener=!1}catch(b){}if(this.plotIpt&&(this.plotIpt.isEdit=a,!a))try{this.plotIpt.edit?this.plotIpt.edit.removeHooks():null,this.map.map.removeLayer(this.plotIpt.deleteMarker),this.plotIpt.isClickListener=!1}catch(b){}if(this.plotImg&&(this.plotImg.isEdit=a,!a))try{this.plotImg.edit?this.plotImg.edit.removeHooks():null,this.map.map.removeLayer(this.plotImg.deleteMarker),this.plotImg.isClickListener=!1}catch(b){}if(this.plotName&&(this.plotName.isEdit=a,!a))try{this.plotName.edit?this.plotName.edit.removeHooks():null,this.map.map.removeLayer(this.plotName.deleteMarker),this.plotName.isClickListener=!1}catch(b){}if(this.wjt&&(this.wjt.isEdit=a,!a))try{this.wjt.edit.removeHooks(),this.wjt.isClickListener=!1}catch(b){}if(this.zwjt&&(this.zwjt.isEdit=a,!a))try{this.wjt.edit.removeHooks(),this.wjt.isClickListener=!1}catch(b){}if(this.djt&&(this.djt.isEdit=a,!a))try{this.djt.edit.removeHooks(),this.djt.isClickListener=!1}catch(b){}if(this.zjt&&(this.zjt.isEdit=a,!a))try{this.zjt.edit.removeHooks(),this.zjt.isClickListener=!1}catch(b){}if(this.sjt&&(this.sjt.isEdit=a,!a))try{this.sjt.edit.removeHooks(),this.sjt.isClickListener=!1}catch(b){}if(this.jhq&&(this.jhq.isEdit=a,!a))try{this.jhq.edit.removeHooks(),this.jhq.isClickListener=!1}catch(b){}if(this.qxqz&&(this.qxqz.isEdit=a,!a))try{this.qxqz.edit.removeHooks(),this.qxqz.isClickListener=!1}catch(b){}if(this.jxqz&&(this.jxqz.isEdit=a,!a))try{this.jxqz.edit.removeHooks(),this.jxqz.isClickListener=!1}catch(b){}if(this.sjqz&&(this.sjqz.isEdit=a,!a))try{this.sjqz.edit.removeHooks(),this.sjqz.isClickListener=!1}catch(b){}},disableAll:function(){this.plotX&&this.plotX.disable(),this.plotM&&this.plotM.disable(),this.plotY&&this.plotY.disable(),this.plotJ&&this.plotJ.disable(),this.plotMpt&&this.plotMpt.disable(),this.plotIpt&&this.plotIpt.disable(),this.plotImg&&this.plotImg.disable(),this.plotName&&this.plotName.disable(),this.wjt&&this.wjt.disable(),this.zwjt&&this.zwjt.disable(),this.djt&&this.djt.disable(),this.zjt&&this.zjt.disable(),this.sjt&&this.sjt.disable(),this.jhq&&this.jhq.disable(),this.qxqz&&this.qxqz.disable(),this.jxqz&&this.jxqz.disable(),this.sjqz&&this.sjqz.disable()},getFrameId:function(){var a=document.getElementById("plotingUI").getElementsByTagName("iframe")[0].id;return a},getUrl:function(a){var b=Aqsc.Util.getBaseImgPath();return b.substring(0,b.length-7)+"plotingUI/"+a},plotOperateArr:[],dotMarkerImgPt:function(a){var b=this;b.disableAll();var c=null;c=-1!=a.style.iconUrl.indexOf("plotingUI")&&-1==a.style.iconUrl.indexOf("..")?{iconUrl:this.getUrl(a.style.iconUrl.substring(15,a.style.iconUrl.length)),size:[a.style.iconSize0,a.style.iconSize1],anchorSize:[a.style.iconAnchor0,a.style.iconAnchor1],opacity:a.style.opacity}:{iconUrl:a.style.iconUrl,size:[a.style.iconSize0,a.style.iconSize1],anchorSize:[a.style.iconAnchor0,a.style.iconAnchor1],opacity:a.style.opacity};var d=Aqsc.Util.guid();b.plotMpt=new Aqsc.PlotMarkerImg(b.map,{markerImg:c,isEdit:b.shapeEdit,id:d}),b.plotMpt.enable(),b.plotMpt.onDrawSucceeded(function(c){var e=c.layer;b.drawMptSucceededLy=e,b.plotMpt.isEnable&&b.drawLayers.push(c.layer),b.plotMpt.addEventListener("click",function(f){tempShape=f.sourceTarget,tempSourceShape=c.target,tempShape.id=d,-1!=a.style.iconUrl.indexOf("plotingUI")&&-1==a.style.iconUrl.indexOf("..")&&(a.style.iconUrl=a.style.iconUrl.substring(15,a.style.iconUrl.length)),a.shapeEdit=b.shapeEdit,setTimeout(function(){e.attr={},$("#"+b.getFrameId()).contents().find("#plot_attr_attr_name").bind("input propertychange",function(){e.attr.name=$("#"+b.getFrameId()).contents().find("#plot_attr_attr_name").val()}),$("#"+b.getFrameId()).contents().find("#plot_attr_attr_remark").bind("input propertychange",function(){e.attr.remark=$("#"+b.getFrameId()).contents().find("#plot_attr_attr_remark").val()})},25),$("#"+b.getFrameId())[0].contentWindow.plotEdit.startEditing(a,[f.latlng])})}),b.plotMpt.plotType="markerImg",b.plotOperateArr.push(b.plotMpt)},dotMarkerIconPt:function(a){var b=this;b.disableAll(),b.plotIpt=new Aqsc.PlotMarkerIcon(b.map,{isEdit:b.shapeEdit,markerIcon:{prefix:a.style.iconClass.split(" ")[0],icon:a.style.iconClass.split(" ")[1],iconColor:a.style.color,markerType:"2",opacity:a.style.opacity,spin:!1,fontSize:a.style.size+"px"}}),b.plotIpt.enable(),b.plotIpt.onDrawSucceeded(function(c){var d=c.layer;b.drawIptSucceededLy=d,b.plotIpt.isEnable&&b.drawLayers.push(c.layer),b.plotIpt.addEventListener("click",function(e){tempShape=e.sourceTarget,tempSourceShape=c.target,a.shapeEdit=b.shapeEdit,setTimeout(function(){d.attr={},$("#"+b.getFrameId()).contents().find("#plot_attr_attr_name").bind("input propertychange",function(){d.attr.name=$("#"+b.getFrameId()).contents().find("#plot_attr_attr_name").val()}),$("#"+b.getFrameId()).contents().find("#plot_attr_attr_remark").bind("input propertychange",function(){d.attr.remark=$("#"+b.getFrameId()).contents().find("#plot_attr_attr_remark").val()})},25),$("#"+b.getFrameId())[0].contentWindow.plotEdit.startEditing(a,[e.latlng])})}),b.plotIpt.plotType="markerIcon",b.plotOperateArr.push(b.plotIpt)},dotMarkerName:function(a){var b=this;b.disableAll(),b.plotName=new Aqsc.PlotMarkerName(b.map,a.style.text,{isEdit:b.shapeEdit,color:a.style.color,fontFamily:a.style.font_family,fontSize:a.style.font_size,fontStyle:a.style.font_style,fontWeight:a.style.font_weight}),b.plotName.enable(),b.plotName.onDrawSucceeded(function(c){var d=c.layer;b.plotName.isEnable&&b.drawLayers.push(c.layer),b.plotName.addEventListener("click",function(e){tempShape=e.sourceTarget,tempSourceShape=c.target,a.shapeEdit=b.shapeEdit,setTimeout(function(){d.attr={},$("#"+b.getFrameId()).contents().find("#plot_attr_attr_name").bind("input propertychange",function(){d.attr.name=$("#"+b.getFrameId()).contents().find("#plot_attr_attr_name").val()}),$("#"+b.getFrameId()).contents().find("#plot_attr_attr_remark").bind("input propertychange",function(){d.attr.remark=$("#"+b.getFrameId()).contents().find("#plot_attr_attr_remark").val()})},25),$("#"+b.getFrameId())[0].contentWindow.plotEdit.startEditing(a,[e.latlng])})}),b.plotName.plotType="markerName",b.plotOperateArr.push(b.plotName)},dotPolyline:function(a){var b=this;b.disableAll(),b.plotX=new Aqsc.PlotShape(b.map,"polyline",{isEdit:b.shapeEdit,style:{color:a.style.color,dashArray:a.style.dashArray,opacity:a.style.opacity,weight:a.style.weight}}),b.plotX.enable(),b.plotX.onDrawSucceeded(function(c){var d=c.layer;b.plotX.isEnable&&b.drawLayers.push(c.layer),b.plotX.addEventListener("click",function(e){tempShape=e.sourceTarget,tempSourceShape=c.target,a.shapeEdit=b.shapeEdit,setTimeout(function(){d.attr={},$("#"+b.getFrameId()).contents().find("#plot_attr_attr_name").bind("input propertychange",function(){d.attr.name=$("#"+b.getFrameId()).contents().find("#plot_attr_attr_name").val()}),$("#"+b.getFrameId()).contents().find("#plot_attr_attr_remark").bind("input propertychange",function(){d.attr.remark=$("#"+b.getFrameId()).contents().find("#plot_attr_attr_remark").val()})},25),$("#"+b.getFrameId())[0].contentWindow.plotEdit.startEditing(a,e.target.editing.latlngs[0])})}),b.plotX.plotType="polyline",b.plotOperateArr.push(b.plotX)},dotPolygon:function(a){var b=this;b.disableAll(),b.plotM=new Aqsc.PlotShape(b.map,"polygon",{isEdit:b.shapeEdit,style:{stroke:a.style.stroke,color:a.style.color,weight:a.style.weight,opacity:a.style.opacity,fill:a.style.fill,fillColor:a.style.fillColor,fillOpacity:a.style.fillOpacity,dashArray:a.style.dashArray}}),b.plotM.enable(),b.plotM.onDrawSucceeded(function(c){var d=c.layer;b.plotM.isEnable&&b.drawLayers.push(c.layer),b.plotM.addEventListener("click",function(e){tempShape=e.sourceTarget,tempSourceShape=c.target,a.shapeEdit=b.shapeEdit,setTimeout(function(){d.attr={},$("#"+b.getFrameId()).contents().find("#plot_attr_attr_name").bind("input propertychange",function(){d.attr.name=$("#"+b.getFrameId()).contents().find("#plot_attr_attr_name").val()}),$("#"+b.getFrameId()).contents().find("#plot_attr_attr_remark").bind("input propertychange",function(){d.attr.remark=$("#"+b.getFrameId()).contents().find("#plot_attr_attr_remark").val()})},25),$("#"+b.getFrameId())[0].contentWindow.plotEdit.startEditing(a,e.target.editing.latlngs[0][0])})}),b.plotM.plotType="polygon",b.plotOperateArr.push(b.plotM)},dotRectangle:function(a){var b=this;b.disableAll(),b.plotJ=new Aqsc.PlotShape(b.map,"rectangle",{isEdit:b.shapeEdit,style:{stroke:a.style.stroke,color:a.style.color,weight:a.style.weight,opacity:a.style.opacity,fill:a.style.fill,fillColor:a.style.fillColor,fillOpacity:a.style.fillOpacity,dashArray:a.style.dashArray}}),b.plotJ.enable(),b.plotJ.onDrawSucceeded(function(c){var d=c.layer;b.plotJ.isEnable&&b.drawLayers.push(c.layer),b.plotJ.addEventListener("click",function(e){tempShape=e.sourceTarget,tempSourceShape=c.target;var f=e.target._latlngs[0][0];a.shapeEdit=b.shapeEdit,setTimeout(function(){d.attr={},$("#"+b.getFrameId()).contents().find("#plot_attr_attr_name").bind("input propertychange",function(){d.attr.name=$("#"+b.getFrameId()).contents().find("#plot_attr_attr_name").val()
}),$("#"+b.getFrameId()).contents().find("#plot_attr_attr_remark").bind("input propertychange",function(){d.attr.remark=$("#"+b.getFrameId()).contents().find("#plot_attr_attr_remark").val()})},25),$("#"+b.getFrameId())[0].contentWindow.plotEdit.startEditing(a,f)})}),b.plotJ.plotType="rectangle",b.plotOperateArr.push(b.plotJ)},dotCircle:function(a){var b=this;b.disableAll(),b.plotY=new Aqsc.PlotShape(b.map,"circle",{isEdit:b.shapeEdit,style:{stroke:a.style.stroke,color:a.style.color,weight:a.style.weight,opacity:a.style.opacity,fill:a.style.fill,fillColor:a.style.fillColor,fillOpacity:a.style.fillOpacity,dashArray:a.style.dashArray}}),b.plotY.enable(),b.plotY.onDrawSucceeded(function(c){var d=c.layer;b.plotY.isEnable&&b.drawLayers.push(c.layer),b.plotY.addEventListener("click",function(e){tempShape=e.sourceTarget,tempSourceShape=c.target,a.style.radius=Math.round(tempShape.style.radius),a.shapeEdit=b.shapeEdit,setTimeout(function(){d.attr={},$("#"+b.getFrameId()).contents().find("#plot_attr_attr_name").bind("input propertychange",function(){d.attr.name=$("#"+b.getFrameId()).contents().find("#plot_attr_attr_name").val()}),$("#"+b.getFrameId()).contents().find("#plot_attr_attr_remark").bind("input propertychange",function(){d.attr.remark=$("#"+b.getFrameId()).contents().find("#plot_attr_attr_remark").val()})},25),$("#"+b.getFrameId())[0].contentWindow.plotEdit.startEditing(a,[e.target._latlng])})}),b.plotY.plotType="circle",b.plotOperateArr.push(b.plotY)},dotImg:function(a){var b=this,c=a.style.iconUrl;-1!=a.style.iconUrl.indexOf("plotingUI")&&-1==a.style.iconUrl.indexOf("..")&&(c=this.getUrl(a.style.iconUrl.substring(15,a.style.iconUrl.length))),b.disableAll(),b.plotImg=new Aqsc.PlotImg(b.map,{isEdit:b.shapeEdit,imgPath:c}),b.plotImg.enable(),b.plotImg.onDrawSucceeded(function(c){var d=c.layer;b.plotImg.isEnable&&b.drawLayers.push(c.layer),b.plotImg.addEventListener("click",function(e){tempShape=e.sourceTarget,tempSourceShape=c.target,-1!=a.style.iconUrl.indexOf("plotingUI")&&-1==a.style.iconUrl.indexOf("..")&&(a.style.iconUrl=a.style.iconUrl.substring(15,a.style.iconUrl.length)),a.shapeEdit=b.shapeEdit,setTimeout(function(){d.attr={},$("#"+b.getFrameId()).contents().find("#plot_attr_attr_name").bind("input propertychange",function(){d.attr.name=$("#"+b.getFrameId()).contents().find("#plot_attr_attr_name").val()}),$("#"+b.getFrameId()).contents().find("#plot_attr_attr_remark").bind("input propertychange",function(){d.attr.remark=$("#"+b.getFrameId()).contents().find("#plot_attr_attr_remark").val()})},25),$("#"+b.getFrameId())[0].contentWindow.plotEdit.startEditing(a,[tempShape.imageOverlayRotateMarkerNW._latlng,tempShape.imageOverlayRotateMarkerNE._latlng,tempShape.imageOverlayRotateMarkerSW._latlng])})}),b.plotImg.plotType="img",b.plotOperateArr.push(b.plotImg)},dotMilitaryPlotT:function(a){var b=this;if(b.disableAll(),"djt"==a.smallType)b.djt=new Aqsc.MilitaryPlot(b.map,"djt",{isEdit:b.shapeEdit,style:a.style}),b.djt.enable(),b.djt.onDrawSucceeded(function(c){var d=L.layerGroup();for(var e in c.layer._layers)c.layer._layers[e].type="militaryPlot",c.layer._layers[e].plotType="djt",d.addLayer(c.layer._layers[e]);b.djt.enabled&&b.drawLayers.push(d),b.djt.addEventListener("click",function(e){tempShape=e.sourceTarget.shape,tempSourceShape=c.target.shape,a.shapeEdit=b.shapeEdit,setTimeout(function(){d.attr={},$("#"+b.getFrameId()).contents().find("#plot_attr_attr_name").bind("input propertychange",function(){d.attr.name=$("#"+b.getFrameId()).contents().find("#plot_attr_attr_name").val()}),$("#"+b.getFrameId()).contents().find("#plot_attr_attr_remark").bind("input propertychange",function(){d.attr.remark=$("#"+b.getFrameId()).contents().find("#plot_attr_attr_remark").val()})},25),$("#"+b.getFrameId())[0].contentWindow.plotEdit.startEditing(a,e.sourceTarget.edit._shape.editing.latlngs[0])})}),b.djt.plotType="djt",b.plotOperateArr.push(b.djt);else switch(a.smallType){case"wjt":b.wjt=new Aqsc.MilitaryPlot(b.map,"wjt",{isEdit:b.shapeEdit,style:a.style}),b.wjt.enable(),b.wjt.onDrawSucceeded(function(c){var d=c.layer;b.wjt.enabled&&b.drawLayers.push(c.layer),b.wjt.addEventListener("click",function(e){tempShape=e.sourceTarget,tempSourceShape=c.target,a.shapeEdit=b.shapeEdit,setTimeout(function(){d.attr={},$("#"+b.getFrameId()).contents().find("#plot_attr_attr_name").bind("input propertychange",function(){d.attr.name=$("#"+b.getFrameId()).contents().find("#plot_attr_attr_name").val()}),$("#"+b.getFrameId()).contents().find("#plot_attr_attr_remark").bind("input propertychange",function(){d.attr.remark=$("#"+b.getFrameId()).contents().find("#plot_attr_attr_remark").val()})},25),$("#"+b.getFrameId())[0].contentWindow.plotEdit.startEditing(a,e.target.editing.latlngs[0][0])})}),b.wjt.plotType="wjt",b.plotOperateArr.push(b.wjt);break;case"zjt":b.zjt=new Aqsc.MilitaryPlot(b.map,"zjt",{isEdit:b.shapeEdit,style:a.style}),b.zjt.enable(),b.zjt.onDrawSucceeded(function(c){var d=c.layer;b.zjt.enabled&&b.drawLayers.push(c.layer),b.zjt.addEventListener("click",function(e){tempShape=e.sourceTarget,tempSourceShape=c.target,a.shapeEdit=b.shapeEdit,setTimeout(function(){d.attr={},$("#"+b.getFrameId()).contents().find("#plot_attr_attr_name").bind("input propertychange",function(){d.attr.name=$("#"+b.getFrameId()).contents().find("#plot_attr_attr_name").val()}),$("#"+b.getFrameId()).contents().find("#plot_attr_attr_remark").bind("input propertychange",function(){d.attr.remark=$("#"+b.getFrameId()).contents().find("#plot_attr_attr_remark").val()})},25),$("#"+b.getFrameId())[0].contentWindow.plotEdit.startEditing(a,e.target.editing.latlngs[0][0])})}),b.zjt.plotType="zjt",b.plotOperateArr.push(b.zjt);break;case"zwjt":b.zwjt=new Aqsc.MilitaryPlot(b.map,"zwjt",{isEdit:b.shapeEdit,style:a.style}),b.zwjt.enable(),b.zwjt.onDrawSucceeded(function(c){var d=c.layer;b.zwjt.enabled&&b.drawLayers.push(c.layer),b.zwjt.addEventListener("click",function(e){tempShape=e.sourceTarget,tempSourceShape=c.target,a.shapeEdit=b.shapeEdit,setTimeout(function(){d.attr={},$("#"+b.getFrameId()).contents().find("#plot_attr_attr_name").bind("input propertychange",function(){d.attr.name=$("#"+b.getFrameId()).contents().find("#plot_attr_attr_name").val()}),$("#"+b.getFrameId()).contents().find("#plot_attr_attr_remark").bind("input propertychange",function(){d.attr.remark=$("#"+b.getFrameId()).contents().find("#plot_attr_attr_remark").val()})},25),$("#"+b.getFrameId())[0].contentWindow.plotEdit.startEditing(a,e.target.editing.latlngs[0][0])})}),b.zwjt.plotType="zwjt",b.plotOperateArr.push(b.zwjt);break;case"sjt":b.sjt=new Aqsc.MilitaryPlot(b.map,"sjt",{isEdit:b.shapeEdit,style:a.style}),b.sjt.enable(),b.sjt.onDrawSucceeded(function(c){var d=c.layer;b.sjt.enabled&&b.drawLayers.push(c.layer),b.sjt.addEventListener("click",function(e){tempShape=e.sourceTarget,tempSourceShape=c.target,a.shapeEdit=b.shapeEdit,setTimeout(function(){d.attr={},$("#"+b.getFrameId()).contents().find("#plot_attr_attr_name").bind("input propertychange",function(){d.attr.name=$("#"+b.getFrameId()).contents().find("#plot_attr_attr_name").val()}),$("#"+b.getFrameId()).contents().find("#plot_attr_attr_remark").bind("input propertychange",function(){d.attr.remark=$("#"+b.getFrameId()).contents().find("#plot_attr_attr_remark").val()})},25),$("#"+b.getFrameId())[0].contentWindow.plotEdit.startEditing(a,e.target.editing.latlngs[0][0])})}),b.sjt.plotType="sjt",b.plotOperateArr.push(b.sjt);break;case"jhq":b.jhq=new Aqsc.MilitaryPlot(b.map,"jhq",{isEdit:b.shapeEdit,style:a.style}),b.jhq.enable(),b.jhq.onDrawSucceeded(function(c){var d=c.layer;b.jhq.enabled&&b.drawLayers.push(c.layer),b.jhq.addEventListener("click",function(e){tempShape=e.sourceTarget,tempSourceShape=c.target,a.shapeEdit=b.shapeEdit,setTimeout(function(){d.attr={},$("#"+b.getFrameId()).contents().find("#plot_attr_attr_name").bind("input propertychange",function(){d.attr.name=$("#"+b.getFrameId()).contents().find("#plot_attr_attr_name").val()}),$("#"+b.getFrameId()).contents().find("#plot_attr_attr_remark").bind("input propertychange",function(){d.attr.remark=$("#"+b.getFrameId()).contents().find("#plot_attr_attr_remark").val()})},25),$("#"+b.getFrameId())[0].contentWindow.plotEdit.startEditing(a,e.target.editing.latlngs[0][0])})}),b.jhq.plotType="jhq",b.plotOperateArr.push(b.jhq);break;case"qxqz":b.qxqz=new Aqsc.MilitaryPlot(b.map,"qxqz",{isEdit:b.shapeEdit,style:a.style}),b.qxqz.enable(),b.qxqz.onDrawSucceeded(function(c){var d=c.layer;b.qxqz.enabled&&b.drawLayers.push(c.layer),b.qxqz.addEventListener("click",function(e){tempShape=e.sourceTarget,tempSourceShape=c.target,a.shapeEdit=b.shapeEdit,setTimeout(function(){d.attr={},$("#"+b.getFrameId()).contents().find("#plot_attr_attr_name").bind("input propertychange",function(){d.attr.name=$("#"+b.getFrameId()).contents().find("#plot_attr_attr_name").val()}),$("#"+b.getFrameId()).contents().find("#plot_attr_attr_remark").bind("input propertychange",function(){d.attr.remark=$("#"+b.getFrameId()).contents().find("#plot_attr_attr_remark").val()})},25),$("#"+b.getFrameId())[0].contentWindow.plotEdit.startEditing(a,e.target.editing.latlngs[0][0])})}),b.qxqz.plotType="qxqz",b.plotOperateArr.push(b.qxqz);break;case"jxqz":b.jxqz=new Aqsc.MilitaryPlot(b.map,"jxqz",{isEdit:b.shapeEdit,style:a.style}),b.jxqz.enable(),b.jxqz.onDrawSucceeded(function(c){var d=c.layer;b.jxqz.enabled&&b.drawLayers.push(c.layer),b.jxqz.addEventListener("click",function(e){tempShape=e.sourceTarget,tempSourceShape=c.target,a.shapeEdit=b.shapeEdit,setTimeout(function(){d.attr={},$("#"+b.getFrameId()).contents().find("#plot_attr_attr_name").bind("input propertychange",function(){d.attr.name=$("#"+b.getFrameId()).contents().find("#plot_attr_attr_name").val()}),$("#"+b.getFrameId()).contents().find("#plot_attr_attr_remark").bind("input propertychange",function(){d.attr.remark=$("#"+b.getFrameId()).contents().find("#plot_attr_attr_remark").val()})},25),$("#"+b.getFrameId())[0].contentWindow.plotEdit.startEditing(a,e.target.editing.latlngs[0][0])})}),b.jxqz.plotType="jxqz",b.plotOperateArr.push(b.jxqz);break;case"sjqz":b.sjqz=new Aqsc.MilitaryPlot(b.map,"sjqz",{isEdit:b.shapeEdit,style:a.style}),b.sjqz.enable(),b.sjqz.onDrawSucceeded(function(c){var d=c.layer;b.sjqz.enabled&&b.drawLayers.push(c.layer),b.sjqz.addEventListener("click",function(e){tempShape=e.sourceTarget,tempSourceShape=c.target,a.shapeEdit=b.shapeEdit,setTimeout(function(){d.attr={},$("#"+b.getFrameId()).contents().find("#plot_attr_attr_name").bind("input propertychange",function(){d.attr.name=$("#"+b.getFrameId()).contents().find("#plot_attr_attr_name").val()}),$("#"+b.getFrameId()).contents().find("#plot_attr_attr_remark").bind("input propertychange",function(){d.attr.remark=$("#"+b.getFrameId()).contents().find("#plot_attr_attr_remark").val()})},25),$("#"+b.getFrameId())[0].contentWindow.plotEdit.startEditing(a,e.target.editing.latlngs[0][0])})}),b.sjqz.plotType="sjqz",b.plotOperateArr.push(b.sjqz)}},setShapeStyle:function(a,b){var c=this;b=b||{};try{if(-1!=a.type.indexOf("militaryPlot"))"djt"==a.samllType?tempShape.setStyle(a.style):(a.style.fillType="1"==a.style.fillType||1==a.style.fillType?"1":"2",tempShape.setStyle(a.style));else switch(a.type){case"marker":{a.style.iconUrl}tempShape.setOpacity(a.style.opacity),-1!=a.style.iconUrl.indexOf("marker")&&-1==a.style.iconUrl.indexOf("..")?tempShape.setMarkerImg(this.getUrl(a.style.iconUrl),[a.style.iconSize0,a.style.iconSize1],[a.style.iconAnchor0,a.style.iconAnchor1]):tempShape.setMarkerImg(a.style.iconUrl,[a.style.iconSize0,a.style.iconSize1],[a.style.iconAnchor0,a.style.iconAnchor1]),a.style.amination?(b.plotOperate._setAmination(!0,{iconSize:[a.style.iconSize0,a.style.iconSize1],iconAnchor:[a.style.iconAnchor0,a.style.iconAnchor1],color:a.style.aminationColor}),c.drawMptSucceededLy.pluse=b.plotOperate.pluse):(b.plotOperate._setAmination(!1),c.drawMptSucceededLy.pluse="");break;case"font-marker":tempShape.setOpacity(a.style.opacity),tempShape.setSize(a.style.size+"px"),tempShape.setColor(a.style.color),a.style.amination?(b.plotOperate._setAmination(!0,{iconSize:[a.style.size,a.style.size],iconAnchor:[16,32],color:a.style.aminationColor}),c.drawIptSucceededLy.pluse=b.plotOperate.pluse):b.plotOperate._setAmination(!1);break;case"polyline":tempShape.setStyle({color:a.style.color,dashArray:a.style.dashArray,opacity:a.style.opacity,weight:a.style.weight});break;case"polygon":tempShape.setStyle({stroke:a.style.stroke,color:a.style.color,weight:a.style.weight,opacity:a.style.opacity,fill:a.style.fill,fillColor:a.style.fillColor,fillOpacity:a.style.fillOpacity,dashArray:a.style.dashArray});break;case"rectangle":tempShape.setStyle({stroke:a.style.stroke,color:a.style.color,weight:a.style.weight,opacity:a.style.opacity,fill:a.style.fill,fillColor:a.style.fillColor,fillOpacity:a.style.fillOpacity,dashArray:a.style.dashArray});break;case"circle":tempShape.setStyle({stroke:a.style.stroke,color:a.style.color,weight:a.style.weight,opacity:a.style.opacity,fill:a.style.fill,fillColor:a.style.fillColor,fillOpacity:a.style.fillOpacity,dashArray:a.style.dashArray}),tempShape.setRadius(a.style.radius);break;case"image":tempShape.setOpacity(a.style.opacity);break;case"text":tempShape.setFontStyle({fontFamily:a.style.font_family,fontSize:a.style.font_size,fontStyle:a.style.font_style,fontWeight:a.style.font_weight,text:a.style.text}),tempShape.setStyle({color:a.style.color,fillOpacity:a.style.opacity})}}catch(d){}}};