!function(a,b){(a = window, b((a.L = a.L || {}, a.L.esri = {}), a.L))}(this,function(a,b){"use strict";function c(a){var b="";a.f=a.f||"json";for(var c in a)if(a.hasOwnProperty(c)){var d,e=a[c],f=Object.prototype.toString.call(e);b.length&&(b+="&"),d="[object Array]"===f?"[object Object]"===Object.prototype.toString.call(e[0])?JSON.stringify(e):e.join(","):"[object Object]"===f?JSON.stringify(e):"[object Date]"===f?e.valueOf():e,b+=encodeURIComponent(c)+"="+encodeURIComponent(d)}return b}function d(a,c){var d=new window.XMLHttpRequest;return d.onerror=function(e){d.onreadystatechange=b.Util.falseFn,a.call(c,{error:{code:500,message:"XMLHttpRequest error"}},null)},d.onreadystatechange=function(){var e,f;if(4===d.readyState){try{e=JSON.parse(d.responseText)}catch(g){e=null,f={code:500,message:"Could not parse response as JSON. This could also be caused by a CORS or XMLHttpRequest error."}}!f&&e.error&&(f=e.error,e=null),d.onerror=b.Util.falseFn,a.call(c,f,e)}},d.ontimeout=function(){this.onerror()},d}function e(a,b,e,f){var g=d(e,f);return g.open("POST",a),"undefined"!=typeof f&&null!==f&&"undefined"!=typeof f.options&&(g.timeout=f.options.timeout),g.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),g.send(c(b)),g}function f(a,b,e,f){var g=d(e,f);return g.open("GET",a+"?"+c(b),!0),"undefined"!=typeof f&&null!==f&&"undefined"!=typeof f.options&&(g.timeout=f.options.timeout),g.send(null),g}function g(a,b,e,f){var g=c(b),i=d(e,f),j=(a+"?"+g).length;if(2e3>=j&&ha.cors?i.open("GET",a+"?"+g):j>2e3&&ha.cors&&(i.open("POST",a),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8")),"undefined"!=typeof f&&null!==f&&"undefined"!=typeof f.options&&(i.timeout=f.options.timeout),2e3>=j&&ha.cors)i.send(null);else{if(!(j>2e3&&ha.cors))return 2e3>=j&&!ha.cors?h(a,b,e,f):void H("a request to "+a+" was longer then 2000 characters and this browser cannot make a cross-domain post request. Please use a proxy http://esri.github.io/esri-leaflet/api-reference/request.html");i.send(g)}return i}function h(a,d,e,f){window._EsriLeafletCallbacks=window._EsriLeafletCallbacks||{};var g="c"+ja;d.callback="window._EsriLeafletCallbacks."+g,window._EsriLeafletCallbacks[g]=function(a){if(window._EsriLeafletCallbacks[g]!==!0){var b,c=Object.prototype.toString.call(a);"[object Object]"!==c&&"[object Array]"!==c&&(b={error:{code:500,message:"Expected array or object as JSONP response"}},a=null),!b&&a.error&&(b=a,a=null),e.call(f,b,a),window._EsriLeafletCallbacks[g]=!0}};var h=b.DomUtil.create("script",null,document.body);return h.type="text/javascript",h.src=a+"?"+c(d),h.id=g,h.onerror=function(a){if(a&&window._EsriLeafletCallbacks[g]!==!0){var b={error:{code:500,message:"An unknown error occurred"}};e.call(f,b),window._EsriLeafletCallbacks[g]=!0}},b.DomUtil.addClass(h,"esri-leaflet-jsonp"),ja++,{id:g,url:h.src,abort:function(){window._EsriLeafletCallbacks._callback[g]({code:0,message:"Request aborted."})}}}function i(a,b){for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0}function j(a){return i(a[0],a[a.length-1])||a.push(a[0]),a}function k(a){var b,c=0,d=0,e=a.length,f=a[d];for(d;e-1>d;d++)b=a[d+1],c+=(b[0]-f[0])*(b[1]+f[1]),f=b;return c>=0}function l(a,b,c,d){var e=(d[0]-c[0])*(a[1]-c[1])-(d[1]-c[1])*(a[0]-c[0]),f=(b[0]-a[0])*(a[1]-c[1])-(b[1]-a[1])*(a[0]-c[0]),g=(d[1]-c[1])*(b[0]-a[0])-(d[0]-c[0])*(b[1]-a[1]);if(0!==g){var h=e/g,i=f/g;if(h>=0&&1>=h&&i>=0&&1>=i)return!0}return!1}function m(a,b){for(var c=0;c<a.length-1;c++)for(var d=0;d<b.length-1;d++)if(l(a[c],a[c+1],b[d],b[d+1]))return!0;return!1}function n(a,b){for(var c=!1,d=-1,e=a.length,f=e-1;++d<e;f=d)(a[d][1]<=b[1]&&b[1]<a[f][1]||a[f][1]<=b[1]&&b[1]<a[d][1])&&b[0]<(a[f][0]-a[d][0])*(b[1]-a[d][1])/(a[f][1]-a[d][1])+a[d][0]&&(c=!c);return c}function o(a,b){var c=m(a,b),d=n(a,b[0]);return!c&&d?!0:!1}function p(a){for(var b,c,d,e=[],f=[],g=0;g<a.length;g++){var h=j(a[g].slice(0));if(!(h.length<4))if(k(h)){var i=[h.slice().reverse()];e.push(i)}else f.push(h.slice().reverse())}for(var l=[];f.length;){d=f.pop();var n=!1;for(b=e.length-1;b>=0;b--)if(c=e[b][0],o(c,d)){e[b].push(d),n=!0;break}n||l.push(d)}for(;l.length;){d=l.pop();var p=!1;for(b=e.length-1;b>=0;b--)if(c=e[b][0],m(c,d)){e[b].push(d),p=!0;break}p||e.push([d.reverse()])}return 1===e.length?{type:"Polygon",coordinates:e[0]}:{type:"MultiPolygon",coordinates:e}}function q(a){var b=[],c=a.slice(0),d=j(c.shift().slice(0));if(d.length>=4){k(d)||d.reverse(),b.push(d);for(var e=0;e<c.length;e++){var f=j(c[e].slice(0));f.length>=4&&(k(f)&&f.reverse(),b.push(f))}}return b}function r(a){for(var b=[],c=0;c<a.length;c++)for(var d=q(a[c]),e=d.length-1;e>=0;e--){var f=d[e].slice(0);b.push(f)}return b}function s(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function t(a,b){for(var c=b?[b,"OBJECTID","FID"]:["OBJECTID","FID"],d=0;d<c.length;d++){var e=c[d];if(e in a&&("string"==typeof a[e]||"number"==typeof a[e]))return a[e]}throw Error("No valid id attribute found")}function u(a,b){var c={};if(a.features){c.type="FeatureCollection",c.features=[];for(var d=0;d<a.features.length;d++)c.features.push(u(a.features[d],b))}if("number"==typeof a.x&&"number"==typeof a.y&&(c.type="Point",c.coordinates=[a.x,a.y],"number"==typeof a.z&&c.coordinates.push(a.z)),a.points&&(c.type="MultiPoint",c.coordinates=a.points.slice(0)),a.paths&&(1===a.paths.length?(c.type="LineString",c.coordinates=a.paths[0].slice(0)):(c.type="MultiLineString",c.coordinates=a.paths.slice(0))),a.rings&&(c=p(a.rings.slice(0))),(a.geometry||a.attributes)&&(c.type="Feature",c.geometry=a.geometry?u(a.geometry):null,c.properties=a.attributes?s(a.attributes):null,a.attributes))try{c.id=t(a.attributes,b)}catch(e){}return JSON.stringify(c.geometry)===JSON.stringify({})&&(c.geometry=null),a.spatialReference&&a.spatialReference.wkid&&4326!==a.spatialReference.wkid&&console.warn("Object converted in non-standard crs - "+JSON.stringify(a.spatialReference)),c}function v(a,b){b=b||"OBJECTID";var c,d={wkid:4326},e={};switch(a.type){case"Point":e.x=a.coordinates[0],e.y=a.coordinates[1],e.spatialReference=d;break;case"MultiPoint":e.points=a.coordinates.slice(0),e.spatialReference=d;break;case"LineString":e.paths=[a.coordinates.slice(0)],e.spatialReference=d;break;case"MultiLineString":e.paths=a.coordinates.slice(0),e.spatialReference=d;break;case"Polygon":e.rings=q(a.coordinates.slice(0)),e.spatialReference=d;break;case"MultiPolygon":e.rings=r(a.coordinates.slice(0)),e.spatialReference=d;break;case"Feature":a.geometry&&(e.geometry=v(a.geometry,b)),e.attributes=a.properties?s(a.properties):{},a.id&&(e.attributes[b]=a.id);break;case"FeatureCollection":for(e=[],c=0;c<a.features.length;c++)e.push(v(a.features[c],b));break;case"GeometryCollection":for(e=[],c=0;c<a.geometries.length;c++)e.push(v(a.geometries[c],b))}return e}function w(a,b){return v(a,b)}function x(a,b){return u(a,b)}function y(a){if("NaN"!==a.xmin&&"NaN"!==a.ymin&&"NaN"!==a.xmax&&"NaN"!==a.ymax){var c=b.latLng(a.ymin,a.xmin),d=b.latLng(a.ymax,a.xmax);return b.latLngBounds(c,d)}return null}function z(a){return a=b.latLngBounds(a),{xmin:a.getSouthWest().lng,ymin:a.getSouthWest().lat,xmax:a.getNorthEast().lng,ymax:a.getNorthEast().lat,spatialReference:{wkid:4326}}}function A(a){var b;if(a.objectIdFieldName)b=a.objectIdFieldName;else if(a.fields){for(var c=0;c<=a.fields.length-1;c++)if("esriFieldTypeOID"===a.fields[c].type){b=a.fields[c].name;break}if(!b)for(c=0;c<=a.fields.length-1;c++)if(a.fields[c].name.match(ma)){b=a.fields[c].name;break}}return b}function B(a){for(var b in a.attributes)if(b.match(ma))return b}function C(a,b){var c,d=a.features||a.results,e=d.length;c=b?b:A(a);var f={type:"FeatureCollection",features:[]};if(e)for(var g=d.length-1;g>=0;g--){var h=x(d[g],c||B(d[g]));f.features.push(h)}return f}function D(a){return a=b.Util.trim(a),"/"!==a[a.length-1]&&(a+="/"),a}function E(a){if(-1!==a.url.indexOf("?")){a.requestParams=a.requestParams||{};var b=a.url.substring(a.url.indexOf("?")+1);a.url=a.url.split("?")[0],a.requestParams=JSON.parse('{"'+decodeURI(b).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}return a.url=D(a.url.split("?")[0]),a}function F(a){return/^(?!.*utility\.arcgis\.com).*\.arcgis\.com.*FeatureServer/i.test(a)}function G(a){var b;switch(a){case"Point":b="esriGeometryPoint";break;case"MultiPoint":b="esriGeometryMultipoint";break;case"LineString":b="esriGeometryPolyline";break;case"MultiLineString":b="esriGeometryPolyline";break;case"Polygon":b="esriGeometryPolygon";break;case"MultiPolygon":b="esriGeometryPolygon"}return b}function H(){console&&console.warn&&console.warn.apply(console,arguments)}function I(a){return a.getSize().x-ia.attributionWidthOffset+"px"}function J(a){if(a.attributionControl&&!a.attributionControl._esriAttributionAdded){a.attributionControl.setPrefix('<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> | Powered by <a href="https://www.esri.com">Esri</a>');var c=document.createElement("style");c.type="text/css",c.innerHTML=".esri-truncated-attribution:hover {white-space: normal;}",document.getElementsByTagName("head")[0].appendChild(c),b.DomUtil.addClass(a.attributionControl._container,"esri-truncated-attribution:hover");var d=document.createElement("style");d.type="text/css",d.innerHTML=".esri-truncated-attribution {vertical-align: -3px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;display: inline-block;transition: 0s white-space;transition-delay: 1s;max-width: "+I(a)+";}",document.getElementsByTagName("head")[0].appendChild(d),b.DomUtil.addClass(a.attributionControl._container,"esri-truncated-attribution"),a.on("resize",function(b){a.attributionControl._container.style.maxWidth=I(b.target)}),a.on("unload",function(){c.parentNode.removeChild(c),d.parentNode.removeChild(d);for(var a=document.querySelectorAll(".esri-leaflet-jsonp"),b=0;b<a.length;b++)a.item(b).parentNode.removeChild(a.item(b))}),a.attributionControl._esriAttributionAdded=!0}}function K(a){var c={geometry:null,geometryType:null};return a instanceof b.LatLngBounds?(c.geometry=z(a),c.geometryType="esriGeometryEnvelope",c):(a.getLatLng&&(a=a.getLatLng()),a instanceof b.LatLng&&(a={type:"Point",coordinates:[a.lng,a.lat]}),a instanceof b.GeoJSON&&(a=a.getLayers()[0].feature.geometry,c.geometry=w(a),c.geometryType=G(a.type)),a.toGeoJSON&&(a=a.toGeoJSON()),"Feature"===a.type&&(a=a.geometry),"Point"===a.type||"LineString"===a.type||"Polygon"===a.type||"MultiPolygon"===a.type?(c.geometry=w(a),c.geometryType=G(a.type),c):void H("invalid geometry passed to spatial query. Should be L.LatLng, L.LatLngBounds, L.Marker or a GeoJSON Point, Line, Polygon or MultiPolygon object"))}function M(a,c){h(a,{},b.Util.bind(function(a,d){if(!a){c._esriAttributions=[];for(var e=0;e<d.contributors.length;e++)for(var f=d.contributors[e],g=0;g<f.coverageAreas.length;g++){var h=f.coverageAreas[g],i=b.latLng(h.bbox[0],h.bbox[1]),j=b.latLng(h.bbox[2],h.bbox[3]);c._esriAttributions.push({attribution:f.attribution,score:h.score,bounds:b.latLngBounds(i,j),minZoom:h.zoomMin,maxZoom:h.zoomMax})}c._esriAttributions.sort(function(a,b){return b.score-a.score});var k={target:c};N(k)}},this))}function N(a){var c=a.target,d=c._esriAttributions;if(c&&c.attributionControl){var e=c.attributionControl._container.querySelector(".esri-dynamic-attribution");if(e&&d){for(var f="",g=c.getBounds(),h=b.latLngBounds(g.getSouthWest().wrap(),g.getNorthEast().wrap()),i=c.getZoom(),j=0;j<d.length;j++){var k=d[j],l=k.attribution;!f.match(l)&&k.bounds.intersects(h)&&i>=k.minZoom&&i<=k.maxZoom&&(f+=", "+l)}f=f.substr(2),e.innerHTML=f,e.style.maxWidth=I(c),c.fire("attributionupdated",{attribution:f})}}}function O(a){return a=E(a),new oa(a)}function P(a){return new pa(a)}function Q(a){return new qa(a)}function R(a){return new ra(a)}function S(a){return new sa(a)}function T(a){return new ta(a)}function U(a){return a=E(a),new ua(a)}function V(a){return new va(a)}function W(a){return new wa(a)}function X(a){return new xa(a)}function Y(a,b){return new za(a,b)}function Z(a,b){return new Aa(a,b)}function $(a,b){return new Da(a,b)}function _(a,b){return new Ea(a,b)}function aa(a){this.values=[].concat(a||[])}function ba(a){return new Ha(a)}function ca(a){return new Ia(a)}function da(a){return new Ja(a)}var ea="2.2.3",fa=window.XMLHttpRequest&&"withCredentials"in new window.XMLHttpRequest,ga=""===document.documentElement.style.pointerEvents,ha={cors:fa,pointerEvents:ga},ia={attributionWidthOffset:55},ja=0,ka=ha.cors?f:h;ka.CORS=f,ka.JSONP=h;var la={request:g,get:ka,post:e},ma=/^(OBJECTID|FID|OID|ID)$/i,na={warn:H,cleanUrl:D,getUrlParams:E,isArcgisOnline:F,geojsonTypeToArcGIS:G,responseToFeatureCollection:C,geojsonToArcGIS:w,arcgisToGeoJSON:x,boundsToExtent:z,extentToBounds:y,calcAttributionWidth:I,setEsriAttribution:J,_setGeometry:K,_getAttributionData:M,_updateMapAttribution:N,_findIdAttributeFromFeature:B,_findIdAttributeFromResponse:A},oa=b.Class.extend({options:{proxy:!1,useCors:fa},generateSetter:function(a,c){return b.Util.bind(function(b){return this.params[a]=b,this},c)},initialize:function(a){if(a.request&&a.options?(this._service=a,b.Util.setOptions(this,a.options)):(b.Util.setOptions(this,a),this.options.url=D(a.url)),this.params=b.Util.extend({},this.params||{}),this.setters)for(var c in this.setters){var d=this.setters[c];this[c]=this.generateSetter(d,this)}},token:function(a){return this._service?this._service.authenticate(a):this.params.token=a,this},format:function(a){return this.params.returnUnformattedValues=!a,this},request:function(a,c){return this.options.requestParams&&b.Util.extend(this.params,this.options.requestParams),this._service?this._service.request(this.path,this.params,a,c):this._request("request",this.path,this.params,a,c)},_request:function(a,b,c,d,e){var f=this.options.proxy?this.options.proxy+"?"+this.options.url+b:this.options.url+b;return"get"!==a&&"request"!==a||this.options.useCors?la[a](f,c,d,e):la.get.JSONP(f,c,d,e)}}),pa=oa.extend({setters:{offset:"resultOffset",limit:"resultRecordCount",fields:"outFields",precision:"geometryPrecision",featureIds:"objectIds",returnGeometry:"returnGeometry",returnM:"returnM",transform:"datumTransformation",token:"token"},path:"query",params:{returnGeometry:!0,where:"1=1",outSr:4326,outFields:"*"},within:function(a){return this._setGeometryParams(a),this.params.spatialRel="esriSpatialRelContains",this},intersects:function(a){return this._setGeometryParams(a),this.params.spatialRel="esriSpatialRelIntersects",this},contains:function(a){return this._setGeometryParams(a),this.params.spatialRel="esriSpatialRelWithin",this},crosses:function(a){return this._setGeometryParams(a),this.params.spatialRel="esriSpatialRelCrosses",this},touches:function(a){return this._setGeometryParams(a),this.params.spatialRel="esriSpatialRelTouches",this},overlaps:function(a){return this._setGeometryParams(a),this.params.spatialRel="esriSpatialRelOverlaps",this},bboxIntersects:function(a){return this._setGeometryParams(a),this.params.spatialRel="esriSpatialRelEnvelopeIntersects",this},indexIntersects:function(a){return this._setGeometryParams(a),this.params.spatialRel="esriSpatialRelIndexIntersects",this},nearby:function(a,c){return a=b.latLng(a),this.params.geometry=[a.lng,a.lat],this.params.geometryType="esriGeometryPoint",this.params.spatialRel="esriSpatialRelIntersects",this.params.units="esriSRUnit_Meter",this.params.distance=c,this.params.inSr=4326,this},where:function(a){return this.params.where=a,this},between:function(a,b){return this.params.time=[a.valueOf(),b.valueOf()],this},simplify:function(a,b){var c=Math.abs(a.getBounds().getWest()-a.getBounds().getEast());return this.params.maxAllowableOffset=c/a.getSize().y*b,this},orderBy:function(a,b){return b=b||"ASC",this.params.orderByFields=this.params.orderByFields?this.params.orderByFields+",":"",this.params.orderByFields+=[a,b].join(" "),this},run:function(a,b){return this._cleanParams(),this.options.isModern||F(this.options.url)?(this.params.f="geojson",this.request(function(c,d){this._trapSQLerrors(c),a.call(b,c,d,d)},this)):this.request(function(c,d){this._trapSQLerrors(c),a.call(b,c,d&&C(d),d)},this)},count:function(a,b){return this._cleanParams(),this.params.returnCountOnly=!0,this.request(function(b,c){a.call(this,b,c&&c.count,c)},b)},ids:function(a,b){return this._cleanParams(),this.params.returnIdsOnly=!0,this.request(function(b,c){a.call(this,b,c&&c.objectIds,c)},b)},bounds:function(a,b){return this._cleanParams(),this.params.returnExtentOnly=!0,this.request(function(c,d){d&&d.extent&&y(d.extent)?a.call(b,c,y(d.extent),d):(c={message:"Invalid Bounds"},a.call(b,c,null,d))},b)},distinct:function(){return this.params.returnGeometry=!1,this.params.returnDistinctValues=!0,this},pixelSize:function(a){var c=b.point(a);return this.params.pixelSize=[c.x,c.y],this},layer:function(a){return this.path=a+"/query",this},_trapSQLerrors:function(a){a&&"400"===a.code&&H("one common syntax error in query requests is encasing string values in double quotes instead of single quotes")},_cleanParams:function(){delete this.params.returnIdsOnly,delete this.params.returnExtentOnly,delete this.params.returnCountOnly},_setGeometryParams:function(a){this.params.inSr=4326;var b=K(a);this.params.geometry=b.geometry,this.params.geometryType=b.geometryType}}),qa=oa.extend({setters:{contains:"contains",text:"searchText",fields:"searchFields",spatialReference:"sr",sr:"sr",layers:"layers",returnGeometry:"returnGeometry",maxAllowableOffset:"maxAllowableOffset",precision:"geometryPrecision",dynamicLayers:"dynamicLayers",returnZ:"returnZ",returnM:"returnM",gdbVersion:"gdbVersion",token:"token"},path:"find",params:{sr:4326,contains:!0,returnGeometry:!0,returnZ:!0,returnM:!1},layerDefs:function(a,b){return this.params.layerDefs=this.params.layerDefs?this.params.layerDefs+";":"",this.params.layerDefs+=[a,b].join(":"),this},simplify:function(a,b){var c=Math.abs(a.getBounds().getWest()-a.getBounds().getEast());return this.params.maxAllowableOffset=c/a.getSize().y*b,this},run:function(a,b){return this.request(function(c,d){a.call(b,c,d&&C(d),d)},b)}}),ra=oa.extend({path:"identify",between:function(a,b){return this.params.time=[a.valueOf(),b.valueOf()],this}}),sa=ra.extend({setters:{layers:"layers",precision:"geometryPrecision",tolerance:"tolerance",returnGeometry:"returnGeometry"},params:{sr:4326,layers:"all",tolerance:3,returnGeometry:!0},on:function(a){var b=z(a.getBounds()),c=a.getSize();return this.params.imageDisplay=[c.x,c.y,96],this.params.mapExtent=[b.xmin,b.ymin,b.xmax,b.ymax],this},at:function(a){return 2===a.length&&(a=b.latLng(a)),this._setGeometryParams(a),this},layerDef:function(a,b){return this.params.layerDefs=this.params.layerDefs?this.params.layerDefs+";":"",this.params.layerDefs+=[a,b].join(":"),this},simplify:function(a,b){var c=Math.abs(a.getBounds().getWest()-a.getBounds().getEast());return this.params.maxAllowableOffset=c/a.getSize().y*b,this},run:function(a,b){return this.request(function(c,d){if(c)return void a.call(b,c,void 0,d);var e=C(d);d.results=d.results.reverse();for(var f=0;f<e.features.length;f++){var g=e.features[f];g.layerId=d.results[f].layerId}a.call(b,void 0,e,d)})},_setGeometryParams:function(a){var b=K(a);this.params.geometry=b.geometry,this.params.geometryType=b.geometryType}}),ta=ra.extend({setters:{setMosaicRule:"mosaicRule",setRenderingRule:"renderingRule",setPixelSize:"pixelSize",returnCatalogItems:"returnCatalogItems",returnGeometry:"returnGeometry"},params:{returnGeometry:!1},at:function(a){return a=b.latLng(a),this.params.geometry=JSON.stringify({x:a.lng,y:a.lat,spatialReference:{wkid:4326}}),this.params.geometryType="esriGeometryPoint",this},getMosaicRule:function(){return this.params.mosaicRule},getRenderingRule:function(){return this.params.renderingRule},getPixelSize:function(){return this.params.pixelSize},run:function(a,b){return this.request(function(c,d){a.call(b,c,d&&this._responseToGeoJSON(d),d)},this)},_responseToGeoJSON:function(a){var b=a.location,c=a.catalogItems,d=a.catalogItemVisibilities,e={pixel:{type:"Feature",geometry:{type:"Point",coordinates:[b.x,b.y]},crs:{type:"EPSG",properties:{code:b.spatialReference.wkid}},properties:{OBJECTID:a.objectId,name:a.name,value:a.value},id:a.objectId}};if(a.properties&&a.properties.Values&&(e.pixel.properties.values=a.properties.Values),c&&c.features&&(e.catalogItems=C(c),d&&d.length===e.catalogItems.features.length))for(var f=d.length-1;f>=0;f--)e.catalogItems.features[f].properties.catalogItemVisibility=d[f];return e}}),ua=b.Evented.extend({options:{proxy:!1,useCors:fa,timeout:0},initialize:function(a){a=a||{},this._requestQueue=[],this._authenticating=!1,b.Util.setOptions(this,a),this.options.url=D(this.options.url)},get:function(a,b,c,d){return this._request("get",a,b,c,d)},post:function(a,b,c,d){return this._request("post",a,b,c,d)},request:function(a,b,c,d){return this._request("request",a,b,c,d)},metadata:function(a,b){return this._request("get","",{},a,b)},authenticate:function(a){return this._authenticating=!1,this.options.token=a,this._runQueue(),this},getTimeout:function(){return this.options.timeout},setTimeout:function(a){this.options.timeout=a},_request:function(a,c,d,e,f){this.fire("requeststart",{url:this.options.url+c,params:d,method:a},!0);var g=this._createServiceCallback(a,c,d,e,f);if(this.options.token&&(d.token=this.options.token),this.options.requestParams&&b.Util.extend(d,this.options.requestParams),this._authenticating)return void this._requestQueue.push([a,c,d,e,f]);var h=this.options.proxy?this.options.proxy+"?"+this.options.url+c:this.options.url+c;return"get"!==a&&"request"!==a||this.options.useCors?la[a](h,d,g,f):la.get.JSONP(h,d,g,f)},_createServiceCallback:function(a,c,d,e,f){return b.Util.bind(function(g,h){!g||499!==g.code&&498!==g.code||(this._authenticating=!0,this._requestQueue.push([a,c,d,e,f]),this.fire("authenticationrequired",{authenticate:b.Util.bind(this.authenticate,this)},!0),g.authenticate=b.Util.bind(this.authenticate,this)),e.call(f,g,h),g?this.fire("requesterror",{url:this.options.url+c,params:d,message:g.message,code:g.code,method:a},!0):this.fire("requestsuccess",{url:this.options.url+c,params:d,response:h,method:a},!0),this.fire("requestend",{url:this.options.url+c,params:d,method:a},!0)},this)},_runQueue:function(){for(var a=this._requestQueue.length-1;a>=0;a--){var b=this._requestQueue[a],c=b.shift();this[c].apply(this,b)}this._requestQueue=[]}}),va=ua.extend({identify:function(){return S(this)},find:function(){return Q(this)},query:function(){return P(this)}}),wa=ua.extend({query:function(){return P(this)},identify:function(){return T(this)}}),xa=ua.extend({options:{idAttribute:"OBJECTID"},query:function(){return P(this)},addFeature:function(a,b,c){this.addFeatures(a,b,c)},addFeatures:function(a,b,c){for(var d=a.features?a.features:[a],e=d.length-1;e>=0;e--)delete d[e].id;return a=w(a),a=d.length>1?a:[a],this.post("addFeatures",{features:a},function(a,d){var e=d&&d.addResults?d.addResults.length>1?d.addResults:d.addResults[0]:void 0;b&&b.call(c,a||d.addResults[0].error,e)},c)},updateFeature:function(a,b,c){this.updateFeatures(a,b,c)},updateFeatures:function(a,b,c){var d=a.features?a.features:[a];return a=w(a,this.options.idAttribute),a=d.length>1?a:[a],this.post("updateFeatures",{features:a},function(a,d){var e=d&&d.updateResults?d.updateResults.length>1?d.updateResults:d.updateResults[0]:void 0;b&&b.call(c,a||d.updateResults[0].error,e)},c)},deleteFeature:function(a,b,c){this.deleteFeatures(a,b,c)},deleteFeatures:function(a,b,c){return this.post("deleteFeatures",{objectIds:a},function(a,d){var e=d&&d.deleteResults?d.deleteResults.length>1?d.deleteResults:d.deleteResults[0]:void 0;b&&b.call(c,a||d.deleteResults[0].error,e)},c)}}),ya="https:"!==window.location.protocol?"http:":"https:",za=b.TileLayer.extend({statics:{TILES:{Streets:{urlTemplate:ya+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/World_Street_Map"}},Topographic:{urlTemplate:ya+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/World_Topo_Map"}},Oceans:{urlTemplate:ya+"//{s}.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/Ocean_Basemap"}},OceansLabels:{urlTemplate:ya+"//{s}.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:ga?"esri-labels":"tilePane",attribution:""}},NationalGeographic:{urlTemplate:ya+"//{s}.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"National Geographic, DeLorme, HERE, UNEP-WCMC, USGS, NASA, ESA, METI, NRCAN, GEBCO, NOAA, increment P Corp."}},DarkGray:{urlTemplate:ya+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"HERE, DeLorme, MapmyIndia, &copy; OpenStreetMap contributors"}},DarkGrayLabels:{urlTemplate:ya+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:ga?"esri-labels":"tilePane",attribution:""}},Gray:{urlTemplate:ya+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"HERE, DeLorme, MapmyIndia, &copy; OpenStreetMap contributors"}},GrayLabels:{urlTemplate:ya+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:ga?"esri-labels":"tilePane",attribution:""}},Imagery:{urlTemplate:ya+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"DigitalGlobe, GeoEye, i-cubed, USDA, USGS, AEX, Getmapping, Aerogrid, IGN, IGP, swisstopo, and the GIS User Community",attributionUrl:"https://static.arcgis.com/attribution/World_Imagery"}},ImageryLabels:{urlTemplate:ya+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],pane:ga?"esri-labels":"tilePane",attribution:""}},ImageryTransportation:{urlTemplate:ya+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Transportation/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],pane:ga?"esri-labels":"tilePane",attribution:""}},ShadedRelief:{urlTemplate:ya+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Shaded_Relief/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:13,subdomains:["server","services"],attribution:"USGS"}},ShadedReliefLabels:{urlTemplate:ya+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places_Alternate/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:12,subdomains:["server","services"],pane:ga?"esri-labels":"tilePane",attribution:""}},Terrain:{urlTemplate:ya+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:13,subdomains:["server","services"],attribution:"USGS, NOAA"}},TerrainLabels:{urlTemplate:ya+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:13,subdomains:["server","services"],pane:ga?"esri-labels":"tilePane",attribution:""}},USATopo:{urlTemplate:ya+"//{s}.arcgisonline.com/ArcGIS/rest/services/USA_Topo_Maps/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:15,subdomains:["server","services"],attribution:"USGS, National Geographic Society, i-cubed"}},ImageryClarity:{urlTemplate:ya+"//clarity.maptiles.arcgis.com/arcgis/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,attribution:"Esri, DigitalGlobe, GeoEye, Earthstar Geographics, CNES/Airbus DS, USDA, USGS, AeroGRID, IGN, and the GIS User Community"}},Physical:{urlTemplate:ya+"//{s}.arcgisonline.com/arcgis/rest/services/World_Physical_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:8,subdomains:["server","services"],attribution:"U.S. National Park Service"}},ImageryFirefly:{urlTemplate:ya+"//fly.maptiles.arcgis.com/arcgis/rest/services/World_Imagery_Firefly/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,attribution:"Esri, DigitalGlobe, GeoEye, Earthstar Geographics, CNES/Airbus DS, USDA, USGS, AeroGRID, IGN, and the GIS User Community",attributionUrl:"https://static.arcgis.com/attribution/World_Imagery"}}}},initialize:function(a,c){var d;if("object"==typeof a&&a.urlTemplate&&a.options)d=a;else{if("string"!=typeof a||!za.TILES[a])throw new Error('L.esri.BasemapLayer: Invalid parameter. Use one of "Streets", "Topographic", "Oceans", "OceansLabels", "NationalGeographic", "Physical", "Gray", "GrayLabels", "DarkGray", "DarkGrayLabels", "Imagery", "ImageryLabels", "ImageryTransportation", "ImageryClarity", "ImageryFirefly", ShadedRelief", "ShadedReliefLabels", "Terrain", "TerrainLabels" or "USATopo"');d=za.TILES[a]}var e=b.Util.extend(d.options,c);b.Util.setOptions(this,e),this.options.token&&-1===d.urlTemplate.indexOf("token=")&&(d.urlTemplate+="?token="+this.options.token),b.TileLayer.prototype.initialize.call(this,d.urlTemplate,e)},onAdd:function(a){J(a),"esri-labels"===this.options.pane&&this._initPane(),this.options.attributionUrl&&M(this.options.attributionUrl,a),a.on("moveend",N),b.TileLayer.prototype.onAdd.call(this,a)},onRemove:function(a){a.off("moveend",N),b.TileLayer.prototype.onRemove.call(this,a)},_initPane:function(){if(!this._map.getPane(this.options.pane)){var a=this._map.createPane(this.options.pane);a.style.pointerEvents="none",a.style.zIndex=500}},getAttribution:function(){if(this.options.attribution)var a='<span class="esri-dynamic-attribution">'+this.options.attribution+"</span>";return a}}),Aa=b.TileLayer.extend({options:{zoomOffsetAllowance:.1,errorTileUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEABAMAAACuXLVVAAAAA1BMVEUzNDVszlHHAAAAAXRSTlMAQObYZgAAAAlwSFlzAAAAAAAAAAAB6mUWpAAAADZJREFUeJztwQEBAAAAgiD/r25IQAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA7waBAAABw08RwAAAAABJRU5ErkJggg=="},statics:{MercatorZoomLevels:{0:156543.033928,1:78271.5169639999,2:39135.7584820001,3:19567.8792409999,4:9783.93962049996,5:4891.96981024998,6:2445.98490512499,7:1222.99245256249,8:611.49622628138,9:305.748113140558,10:152.874056570411,11:76.4370282850732,12:38.2185141425366,13:19.1092570712683,14:9.55462853563415,15:4.77731426794937,16:2.38865713397468,17:1.19432856685505,18:.597164283559817,19:.298582141647617,20:.14929107082381,21:.07464553541191,22:.0373227677059525,23:.0186613838529763}},initialize:function(a){a=b.Util.setOptions(this,a),a=E(a),this.tileUrl=(a.proxy?a.proxy+"?":"")+a.url+"tile/{z}/{y}/{x}"+(a.requestParams&&Object.keys(a.requestParams).length>0?b.Util.getParamString(a.requestParams):""),-1!==a.url.indexOf("{s}")&&a.subdomains&&(a.url=a.url.replace("{s}",a.subdomains[0])),this.service=V(a),this.service.addEventParent(this);var c=new RegExp(/tiles.arcgis(online)?\.com/g);c.test(a.url)&&(this.tileUrl=this.tileUrl.replace("://tiles","://tiles{s}"),a.subdomains=["1","2","3","4"]),this.options.token&&(this.tileUrl+="?token="+this.options.token),
b.TileLayer.prototype.initialize.call(this,this.tileUrl,a)},getTileUrl:function(a){var c=this._getZoomForUrl();return b.Util.template(this.tileUrl,b.Util.extend({s:this._getSubdomain(a),x:a.x,y:a.y,z:this._lodMap&&this._lodMap[c]?this._lodMap[c]:c},this.options))},createTile:function(a,c){var d=document.createElement("img");return b.DomEvent.on(d,"load",b.Util.bind(this._tileOnLoad,this,c,d)),b.DomEvent.on(d,"error",b.Util.bind(this._tileOnError,this,c,d)),this.options.crossOrigin&&(d.crossOrigin=""),d.alt="",!this._lodMap||this._lodMap&&this._lodMap[this._getZoomForUrl()]?d.src=this.getTileUrl(a):this.once("lodmap",function(){d.src=this.getTileUrl(a)},this),d},onAdd:function(a){J(a),this._lodMap||this.metadata(function(c,d){if(!c&&d.spatialReference){var e=d.spatialReference.latestWkid||d.spatialReference.wkid;if(!this.options.attribution&&a.attributionControl&&d.copyrightText&&(this.options.attribution=d.copyrightText,a.attributionControl.addAttribution(this.getAttribution())),a.options.crs!==b.CRS.EPSG3857||102100!==e&&3857!==e)a.options.crs&&a.options.crs.code&&a.options.crs.code.indexOf(e)>-1||H("L.esri.TiledMapLayer is using a non-mercator spatial reference. Support may be available through Proj4Leaflet http://esri.github.io/esri-leaflet/examples/non-mercator-projection.html");else{this._lodMap={};for(var f=d.tileInfo.lods,g=Aa.MercatorZoomLevels,h=0;h<f.length;h++){var i=f[h];for(var j in g){var k=g[j];if(this._withinPercentage(i.resolution,k,this.options.zoomOffsetAllowance)){this._lodMap[j]=i.level;break}}}this.fire("lodmap")}}},this),b.TileLayer.prototype.onAdd.call(this,a)},metadata:function(a,b){return this.service.metadata(a,b),this},identify:function(){return this.service.identify()},find:function(){return this.service.find()},query:function(){return this.service.query()},authenticate:function(a){var b="?token="+a;return this.tileUrl=this.options.token?this.tileUrl.replace(/\?token=(.+)/g,b):this.tileUrl+b,this.options.token=a,this.service.authenticate(a),this},_withinPercentage:function(a,b,c){var d=Math.abs(a/b-1);return c>d}}),Ba=b.ImageOverlay.extend({onAdd:function(a){this._topLeft=a.getPixelBounds().min,b.ImageOverlay.prototype.onAdd.call(this,a)},_reset:function(){this._map.options.crs===b.CRS.EPSG3857?b.ImageOverlay.prototype._reset.call(this):b.DomUtil.setPosition(this._image,this._topLeft.subtract(this._map.getPixelOrigin()))}}),Ca=b.Layer.extend({options:{opacity:1,position:"front",f:"image",useCors:fa,attribution:null,interactive:!1,alt:""},onAdd:function(a){J(a),this.options.zIndex&&(this.options.position=null),this._update=b.Util.throttle(this._update,this.options.updateInterval,this),a.on("moveend",this._update,this),this._currentImage&&this._currentImage._bounds.equals(this._map.getBounds())?a.addLayer(this._currentImage):this._currentImage&&(this._map.removeLayer(this._currentImage),this._currentImage=null),this._update(),this._popup&&(this._map.on("click",this._getPopupData,this),this._map.on("dblclick",this._resetPopupState,this)),this.metadata(function(b,c){!b&&!this.options.attribution&&a.attributionControl&&c.copyrightText&&(this.options.attribution=c.copyrightText,a.attributionControl.addAttribution(this.getAttribution()))},this)},onRemove:function(a){this._currentImage&&this._map.removeLayer(this._currentImage),this._popup&&(this._map.off("click",this._getPopupData,this),this._map.off("dblclick",this._resetPopupState,this)),this._map.off("moveend",this._update,this)},bindPopup:function(a,c){return this._shouldRenderPopup=!1,this._lastClick=!1,this._popup=b.popup(c),this._popupFunction=a,this._map&&(this._map.on("click",this._getPopupData,this),this._map.on("dblclick",this._resetPopupState,this)),this},unbindPopup:function(){return this._map&&(this._map.closePopup(this._popup),this._map.off("click",this._getPopupData,this),this._map.off("dblclick",this._resetPopupState,this)),this._popup=!1,this},bringToFront:function(){return this.options.position="front",this._currentImage&&(this._currentImage.bringToFront(),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this.options.position="back",this._currentImage&&(this._currentImage.bringToBack(),this._setAutoZIndex(Math.min)),this},setZIndex:function(a){return this.options.zIndex=a,this._currentImage&&this._currentImage.setZIndex(a),this},_setAutoZIndex:function(a){if(this._currentImage){for(var b,c=this._currentImage.getPane().children,d=-a(-(1/0),1/0),e=0,f=c.length;f>e;e++)b=c[e].style.zIndex,c[e]!==this._currentImage._image&&b&&(d=a(d,+b));isFinite(d)&&(this.options.zIndex=d+a(-1,1),this.setZIndex(this.options.zIndex))}},getAttribution:function(){return this.options.attribution},getOpacity:function(){return this.options.opacity},setOpacity:function(a){return this.options.opacity=a,this._currentImage&&this._currentImage.setOpacity(a),this},getTimeRange:function(){return[this.options.from,this.options.to]},setTimeRange:function(a,b){return this.options.from=a,this.options.to=b,this._update(),this},metadata:function(a,b){return this.service.metadata(a,b),this},authenticate:function(a){return this.service.authenticate(a),this},redraw:function(){this._update()},_renderImage:function(a,b,c){if(this._map){if(c&&(a="data:"+c+";base64,"+a),!a)return;var d=new Ba(a,b,{opacity:0,crossOrigin:this.options.useCors,alt:this.options.alt,pane:this.options.pane||this.getPane(),interactive:this.options.interactive}).addTo(this._map),e=function(){this._map.removeLayer(d),this.fire("error"),d.off("load",f,this)},f=function(a){if(d.off("error",f,this),this._map){var c=a.target,e=this._currentImage;c._bounds.equals(b)&&c._bounds.equals(this._map.getBounds())?(this._currentImage=c,"front"===this.options.position?this.bringToFront():"back"===this.options.position&&this.bringToBack(),this.options.zIndex&&this.setZIndex(this.options.zIndex),this._map&&this._currentImage._map?this._currentImage.setOpacity(this.options.opacity):this._currentImage._map.removeLayer(this._currentImage),e&&this._map&&this._map.removeLayer(e),e&&e._map&&e._map.removeLayer(e)):this._map.removeLayer(c)}this.fire("load",{bounds:b})};d.once("error",e,this),d.once("load",f,this),this.fire("loading",{bounds:b})}},_update:function(){if(this._map){var a=this._map.getZoom(),c=this._map.getBounds();if(!(this._animatingZoom||this._map._panTransition&&this._map._panTransition._inProgress)){if(a>this.options.maxZoom||a<this.options.minZoom)return void(this._currentImage&&(this._currentImage._map.removeLayer(this._currentImage),this._currentImage=null));var d=this._buildExportParams();b.Util.extend(d,this.options.requestParams),d?this._requestExport(d,c):this._currentImage&&(this._currentImage._map.removeLayer(this._currentImage),this._currentImage=null)}}},_renderPopup:function(a,c,d,e){if(a=b.latLng(a),this._shouldRenderPopup&&this._lastClick.equals(a)){var f=this._popupFunction(c,d,e);f&&this._popup.setLatLng(a).setContent(f).openOn(this._map)}},_resetPopupState:function(a){this._shouldRenderPopup=!1,this._lastClick=a.latlng},_calculateBbox:function(){var a=this._map.getPixelBounds(),c=this._map.unproject(a.getBottomLeft()),d=this._map.unproject(a.getTopRight()),e=this._map.options.crs.project(d),f=this._map.options.crs.project(c),g=b.bounds(e,f);return[g.getBottomLeft().x,g.getBottomLeft().y,g.getTopRight().x,g.getTopRight().y].join(",")},_calculateImageSize:function(){var a=this._map.getPixelBounds(),b=this._map.getSize(),c=this._map.unproject(a.getBottomLeft()),d=this._map.unproject(a.getTopRight()),e=this._map.latLngToLayerPoint(d).y,f=this._map.latLngToLayerPoint(c).y;return(e>0||f<b.y)&&(b.y=f-e),b.x+","+b.y}}),Da=Ca.extend({options:{updateInterval:150,format:"jpgpng",transparent:!0,f:"image"},query:function(){return this.service.query()},identify:function(){return this.service.identify()},initialize:function(a){a=E(a),this.service=W(a),this.service.addEventParent(this),b.Util.setOptions(this,a)},setPixelType:function(a){return this.options.pixelType=a,this._update(),this},getPixelType:function(){return this.options.pixelType},setBandIds:function(a){return b.Util.isArray(a)?this.options.bandIds=a.join(","):this.options.bandIds=a.toString(),this._update(),this},getBandIds:function(){return this.options.bandIds},setNoData:function(a,c){return b.Util.isArray(a)?this.options.noData=a.join(","):this.options.noData=a.toString(),c&&(this.options.noDataInterpretation=c),this._update(),this},getNoData:function(){return this.options.noData},getNoDataInterpretation:function(){return this.options.noDataInterpretation},setRenderingRule:function(a){this.options.renderingRule=a,this._update()},getRenderingRule:function(){return this.options.renderingRule},setMosaicRule:function(a){this.options.mosaicRule=a,this._update()},getMosaicRule:function(){return this.options.mosaicRule},_getPopupData:function(a){var c=b.Util.bind(function(c,d,e){c||setTimeout(b.Util.bind(function(){this._renderPopup(a.latlng,c,d,e)},this),300)},this),d=this.identify().at(a.latlng);this.options.mosaicRule&&d.setMosaicRule(this.options.mosaicRule),d.run(c),this._shouldRenderPopup=!0,this._lastClick=a.latlng},_buildExportParams:function(){var a=parseInt(this._map.options.crs.code.split(":")[1],10),b={bbox:this._calculateBbox(),size:this._calculateImageSize(),format:this.options.format,transparent:this.options.transparent,bboxSR:a,imageSR:a};return this.options.from&&this.options.to&&(b.time=this.options.from.valueOf()+","+this.options.to.valueOf()),this.options.pixelType&&(b.pixelType=this.options.pixelType),this.options.interpolation&&(b.interpolation=this.options.interpolation),this.options.compressionQuality&&(b.compressionQuality=this.options.compressionQuality),this.options.bandIds&&(b.bandIds=this.options.bandIds),(0===this.options.noData||this.options.noData)&&(b.noData=this.options.noData),this.options.noDataInterpretation&&(b.noDataInterpretation=this.options.noDataInterpretation),this.service.options.token&&(b.token=this.service.options.token),this.options.renderingRule&&(b.renderingRule=JSON.stringify(this.options.renderingRule)),this.options.mosaicRule&&(b.mosaicRule=JSON.stringify(this.options.mosaicRule)),b},_requestExport:function(a,c){"json"===this.options.f?this.service.request("exportImage",a,function(a,b){a||(this.options.token&&(b.href+="?token="+this.options.token),this.options.proxy&&(b.href=this.options.proxy+"?"+b.href),this._renderImage(b.href,c))},this):(a.f="image",this._renderImage(this.options.url+"exportImage"+b.Util.getParamString(a),c))}}),Ea=Ca.extend({options:{updateInterval:150,layers:!1,layerDefs:!1,timeOptions:!1,format:"png24",transparent:!0,f:"json"},initialize:function(a){a=E(a),this.service=V(a),this.service.addEventParent(this),(a.proxy||a.token)&&"json"!==a.f&&(a.f="json"),b.Util.setOptions(this,a)},getDynamicLayers:function(){return this.options.dynamicLayers},setDynamicLayers:function(a){return this.options.dynamicLayers=a,this._update(),this},getLayers:function(){return this.options.layers},setLayers:function(a){return this.options.layers=a,this._update(),this},getLayerDefs:function(){return this.options.layerDefs},setLayerDefs:function(a){return this.options.layerDefs=a,this._update(),this},getTimeOptions:function(){return this.options.timeOptions},setTimeOptions:function(a){return this.options.timeOptions=a,this._update(),this},query:function(){return this.service.query()},identify:function(){return this.service.identify()},find:function(){return this.service.find()},_getPopupData:function(a){var c,d=b.Util.bind(function(c,d,e){c||setTimeout(b.Util.bind(function(){this._renderPopup(a.latlng,c,d,e)},this),300)},this);if(c=this.options.popup?this.options.popup.on(this._map).at(a.latlng):this.identify().on(this._map).at(a.latlng),c.params.maxAllowableOffset?!0:c.simplify(this._map,.5),this.options.popup&&this.options.popup.params&&this.options.popup.params.layers||(this.options.layers?c.layers("visible:"+this.options.layers.join(",")):c.layers("visible")),this.options.layerDefs&&"string"!=typeof this.options.layerDefs&&!c.params.layerDefs)for(var e in this.options.layerDefs)this.options.layerDefs.hasOwnProperty(e)&&c.layerDef(e,this.options.layerDefs[e]);c.run(d),this._shouldRenderPopup=!0,this._lastClick=a.latlng},_buildExportParams:function(){var a=parseInt(this._map.options.crs.code.split(":")[1],10),b={bbox:this._calculateBbox(),size:this._calculateImageSize(),dpi:96,format:this.options.format,transparent:this.options.transparent,bboxSR:a,imageSR:a};if(this.options.dynamicLayers&&(b.dynamicLayers=this.options.dynamicLayers),this.options.layers){if(0===this.options.layers.length)return;b.layers="show:"+this.options.layers.join(",")}return this.options.layerDefs&&(b.layerDefs="string"==typeof this.options.layerDefs?this.options.layerDefs:JSON.stringify(this.options.layerDefs)),this.options.timeOptions&&(b.timeOptions=JSON.stringify(this.options.timeOptions)),this.options.from&&this.options.to&&(b.time=this.options.from.valueOf()+","+this.options.to.valueOf()),this.service.options.token&&(b.token=this.service.options.token),this.options.proxy&&(b.proxy=this.options.proxy),this.options.disableCache&&(b._ts=Date.now()),b},_requestExport:function(a,c){"json"===this.options.f?this.service.request("export",a,function(a,b){a||(this.options.token&&(b.href+="?token="+this.options.token),this.options.proxy&&(b.href=this.options.proxy+"?"+b.href),b.href?this._renderImage(b.href,c):this._renderImage(b.imageData,c,b.contentType))},this):(a.f="image",this._renderImage(this.options.url+"export"+b.Util.getParamString(a),c))}}),Fa=b.Layer.extend({options:{cellSize:512,updateInterval:150},initialize:function(a){a=b.setOptions(this,a),this._zooming=!1},onAdd:function(a){this._map=a,this._update=b.Util.throttle(this._update,this.options.updateInterval,this),this._reset(),this._update()},onRemove:function(){this._map.removeEventListener(this.getEvents(),this),this._removeCells()},getEvents:function(){var a={moveend:this._update,zoomstart:this._zoomstart,zoomend:this._reset};return a},addTo:function(a){return a.addLayer(this),this},removeFrom:function(a){return a.removeLayer(this),this},_zoomstart:function(){this._zooming=!0},_reset:function(){this._removeCells(),this._cells={},this._activeCells={},this._cellsToLoad=0,this._cellsTotal=0,this._cellNumBounds=this._getCellNumBounds(),this._resetWrap(),this._zooming=!1},_resetWrap:function(){var a=this._map,b=a.options.crs;if(!b.infinite){var c=this._getCellSize();b.wrapLng&&(this._wrapLng=[Math.floor(a.project([0,b.wrapLng[0]]).x/c),Math.ceil(a.project([0,b.wrapLng[1]]).x/c)]),b.wrapLat&&(this._wrapLat=[Math.floor(a.project([b.wrapLat[0],0]).y/c),Math.ceil(a.project([b.wrapLat[1],0]).y/c)])}},_getCellSize:function(){return this.options.cellSize},_update:function(){if(this._map){var a=this._map.getPixelBounds(),c=this._getCellSize(),d=b.bounds(a.min.divideBy(c).floor(),a.max.divideBy(c).floor());this._removeOtherCells(d),this._addCells(d),this.fire("cellsupdated")}},_addCells:function(a){var c,d,e,f=[],g=a.getCenter(),h=this._map.getZoom();for(c=a.min.y;c<=a.max.y;c++)for(d=a.min.x;d<=a.max.x;d++)e=b.point(d,c),e.z=h,this._isValidCell(e)&&f.push(e);var i=f.length;if(0!==i)for(this._cellsToLoad+=i,this._cellsTotal+=i,f.sort(function(a,b){return a.distanceTo(g)-b.distanceTo(g)}),d=0;i>d;d++)this._addCell(f[d])},_isValidCell:function(a){var c=this._map.options.crs;if(!c.infinite){var d=this._cellNumBounds;if(!c.wrapLng&&(a.x<d.min.x||a.x>d.max.x)||!c.wrapLat&&(a.y<d.min.y||a.y>d.max.y))return!1}if(!this.options.bounds)return!0;var e=this._cellCoordsToBounds(a);return b.latLngBounds(this.options.bounds).intersects(e)},_cellCoordsToBounds:function(a){var c=this._map,d=this.options.cellSize,e=a.multiplyBy(d),f=e.add([d,d]),g=c.wrapLatLng(c.unproject(e,a.z)),h=c.wrapLatLng(c.unproject(f,a.z));return b.latLngBounds(g,h)},_cellCoordsToKey:function(a){return a.x+":"+a.y},_keyToCellCoords:function(a){var c=a.split(":"),d=parseInt(c[0],10),e=parseInt(c[1],10);return b.point(d,e)},_removeOtherCells:function(a){for(var b in this._cells)a.contains(this._keyToCellCoords(b))||this._removeCell(b)},_removeCell:function(a){var b=this._activeCells[a];b&&(delete this._activeCells[a],this.cellLeave&&this.cellLeave(b.bounds,b.coords),this.fire("cellleave",{bounds:b.bounds,coords:b.coords}))},_removeCells:function(){for(var a in this._cells){var b=this._cells[a].bounds,c=this._cells[a].coords;this.cellLeave&&this.cellLeave(b,c),this.fire("cellleave",{bounds:b,coords:c})}},_addCell:function(a){this._wrapCoords(a);var b=this._cellCoordsToKey(a),c=this._cells[b];c&&!this._activeCells[b]&&(this.cellEnter&&this.cellEnter(c.bounds,a),this.fire("cellenter",{bounds:c.bounds,coords:a}),this._activeCells[b]=c),c||(c={coords:a,bounds:this._cellCoordsToBounds(a)},this._cells[b]=c,this._activeCells[b]=c,this.createCell&&this.createCell(c.bounds,a),this.fire("cellcreate",{bounds:c.bounds,coords:a}))},_wrapCoords:function(a){a.x=this._wrapLng?b.Util.wrapNum(a.x,this._wrapLng):a.x,a.y=this._wrapLat?b.Util.wrapNum(a.y,this._wrapLat):a.y},_getCellNumBounds:function(){var a=this._map.getPixelWorldBounds(),c=this._getCellSize();return a?b.bounds(a.min.divideBy(c).floor(),a.max.divideBy(c).ceil().subtract([1,1])):null}});aa.prototype.query=function(a){var b=this.getIndex(a);return this.values[b]},aa.prototype.getIndex=function(a){this.dirty&&this.sort();for(var b,c,d=0,e=this.values.length-1;e>=d;)if(b=(d+e)/2|0,c=this.values[Math.round(b)],+c.value<+a)d=b+1;else{if(!(+c.value>+a))return b;e=b-1}return Math.abs(~e)},aa.prototype.between=function(a,b){var c=this.getIndex(a),d=this.getIndex(b);if(0===c&&0===d)return[];for(;this.values[c-1]&&this.values[c-1].value===a;)c--;for(;this.values[d+1]&&this.values[d+1].value===b;)d++;return this.values[d]&&this.values[d].value===b&&this.values[d+1]&&d++,this.values.slice(c,d)},aa.prototype.insert=function(a){return this.values.splice(this.getIndex(a.value),0,a),this},aa.prototype.bulkAdd=function(a,b){return this.values=this.values.concat([].concat(a||[])),b?this.sort():this.dirty=!0,this},aa.prototype.sort=function(){return this.values.sort(function(a,b){return+b.value-+a.value}).reverse(),this.dirty=!1,this};var Ga=Fa.extend({options:{attribution:null,where:"1=1",fields:["*"],from:!1,to:!1,timeField:!1,timeFilterMode:"server",simplifyFactor:0,precision:6},initialize:function(a){if(Fa.prototype.initialize.call(this,a),a=E(a),a=b.Util.setOptions(this,a),this.service=X(a),this.service.addEventParent(this),"*"!==this.options.fields[0]){for(var c=!1,d=0;d<this.options.fields.length;d++)this.options.fields[d].match(/^(OBJECTID|FID|OID|ID)$/i)&&(c=!0);c===!1&&H("no known esriFieldTypeOID field detected in fields Array.  Please add an attribute field containing unique IDs to ensure the layer can be drawn correctly.")}this.options.timeField.start&&this.options.timeField.end?(this._startTimeIndex=new aa,this._endTimeIndex=new aa):this.options.timeField&&(this._timeIndex=new aa),this._cache={},this._currentSnapshot=[],this._activeRequests=0},onAdd:function(a){return J(a),this.service.metadata(function(b,c){if(!b){var d=c.supportedQueryFormats,e=!1;this.service.options.isModern===!1&&(e=!0),!e&&d&&-1!==d.indexOf("geoJSON")&&(this.service.options.isModern=!0),c.objectIdField&&(this.service.options.idAttribute=c.objectIdField),!this.options.attribution&&a.attributionControl&&c.copyrightText&&(this.options.attribution=c.copyrightText,a.attributionControl.addAttribution(this.getAttribution()))}},this),a.on("zoomend",this._handleZoomChange,this),Fa.prototype.onAdd.call(this,a)},onRemove:function(a){return a.off("zoomend",this._handleZoomChange,this),Fa.prototype.onRemove.call(this,a)},getAttribution:function(){return this.options.attribution},createCell:function(a,b){this._visibleZoom()&&this._requestFeatures(a,b)},_requestFeatures:function(a,c,d){return this._activeRequests++,1===this._activeRequests&&this.fire("loading",{bounds:a},!0),this._buildQuery(a).run(function(e,f,g){g&&g.exceededTransferLimit&&this.fire("drawlimitexceeded"),!e&&f&&f.features.length&&b.Util.requestAnimFrame(b.Util.bind(function(){this._addFeatures(f.features,c),this._postProcessFeatures(a)},this)),e||!f||f.features.length||this._postProcessFeatures(a),e&&this._postProcessFeatures(a),d&&d.call(this,e,f)},this)},_postProcessFeatures:function(a){this._activeRequests--,this._activeRequests<=0&&this.fire("load",{bounds:a})},_cacheKey:function(a){return a.z+":"+a.x+":"+a.y},_addFeatures:function(a,b){var c=this._cacheKey(b);this._cache[c]=this._cache[c]||[];for(var d=a.length-1;d>=0;d--){var e=a[d].id;-1===this._currentSnapshot.indexOf(e)&&this._currentSnapshot.push(e),-1===this._cache[c].indexOf(e)&&this._cache[c].push(e)}this.options.timeField&&this._buildTimeIndexes(a),this.createLayers(a)},_buildQuery:function(a){var c=this.service.query().intersects(a).where(this.options.where).fields(this.options.fields).precision(this.options.precision);return this.options.requestParams&&b.Util.extend(c.params,this.options.requestParams),this.options.simplifyFactor&&c.simplify(this._map,this.options.simplifyFactor),"server"===this.options.timeFilterMode&&this.options.from&&this.options.to&&c.between(this.options.from,this.options.to),c},setWhere:function(a,c,d){this.options.where=a&&a.length?a:"1=1";for(var e=[],f=[],g=0,h=null,i=b.Util.bind(function(a,i){if(a&&(h=a),i)for(var j=i.features.length-1;j>=0;j--)f.push(i.features[j].id);g--,0>=g&&this._visibleZoom()&&(this._currentSnapshot=f,b.Util.requestAnimFrame(b.Util.bind(function(){this.removeLayers(e),this.addLayers(f),c&&c.call(d,h)},this)))},this),j=this._currentSnapshot.length-1;j>=0;j--)e.push(this._currentSnapshot[j]);for(var k in this._activeCells){g++;var l=this._keyToCellCoords(k),m=this._cellCoordsToBounds(l);this._requestFeatures(m,k,i)}return this},getWhere:function(){return this.options.where},getTimeRange:function(){return[this.options.from,this.options.to]},setTimeRange:function(a,c,d,e){var f=this.options.from,g=this.options.to,h=0,i=null,j=b.Util.bind(function(b){b&&(i=b),this._filterExistingFeatures(f,g,a,c),h--,d&&0>=h&&d.call(e,i)},this);if(this.options.from=a,this.options.to=c,this._filterExistingFeatures(f,g,a,c),"server"===this.options.timeFilterMode)for(var k in this._activeCells){h++;var l=this._keyToCellCoords(k),m=this._cellCoordsToBounds(l);this._requestFeatures(m,k,j)}return this},refresh:function(){for(var a in this._activeCells){var b=this._keyToCellCoords(a),c=this._cellCoordsToBounds(b);this._requestFeatures(c,a)}this.redraw&&this.once("load",function(){this.eachFeature(function(a){this._redraw(a.feature.id)},this)},this)},_filterExistingFeatures:function(a,c,d,e){var f=a&&c?this._getFeaturesInTimeRange(a,c):this._currentSnapshot,g=this._getFeaturesInTimeRange(d,e);if(g.indexOf)for(var h=0;h<g.length;h++){var i=f.indexOf(g[h]);i>=0&&f.splice(i,1)}b.Util.requestAnimFrame(b.Util.bind(function(){this.removeLayers(f),this.addLayers(g)},this))},_getFeaturesInTimeRange:function(a,b){var c,d=[];if(this.options.timeField.start&&this.options.timeField.end){var e=this._startTimeIndex.between(a,b),f=this._endTimeIndex.between(a,b);c=e.concat(f)}else c=this._timeIndex.between(a,b);for(var g=c.length-1;g>=0;g--)d.push(c[g].id);return d},_buildTimeIndexes:function(a){var b,c;if(this.options.timeField.start&&this.options.timeField.end){var d=[],e=[];for(b=a.length-1;b>=0;b--)c=a[b],d.push({id:c.id,value:new Date(c.properties[this.options.timeField.start])}),e.push({id:c.id,value:new Date(c.properties[this.options.timeField.end])});this._startTimeIndex.bulkAdd(d),this._endTimeIndex.bulkAdd(e)}else{var f=[];for(b=a.length-1;b>=0;b--)c=a[b],f.push({id:c.id,value:new Date(c.properties[this.options.timeField])});this._timeIndex.bulkAdd(f)}},_featureWithinTimeRange:function(a){if(!this.options.from||!this.options.to)return!0;var b=+this.options.from.valueOf(),c=+this.options.to.valueOf();if("string"==typeof this.options.timeField){var d=+a.properties[this.options.timeField];return d>=b&&c>=d}if(this.options.timeField.start&&this.options.timeField.end){var e=+a.properties[this.options.timeField.start],f=+a.properties[this.options.timeField.end];return e>=b&&c>=e||f>=b&&c>=f}},_visibleZoom:function(){if(!this._map)return!1;var a=this._map.getZoom();return a>this.options.maxZoom||a<this.options.minZoom?!1:!0},_handleZoomChange:function(){if(this._visibleZoom())for(var a in this._activeCells){var b=this._activeCells[a].coords,c=this._cacheKey(b);this._cache[c]&&this.addLayers(this._cache[c])}else this.removeLayers(this._currentSnapshot),this._currentSnapshot=[]},authenticate:function(a){return this.service.authenticate(a),this},metadata:function(a,b){return this.service.metadata(a,b),this},query:function(){return this.service.query()},_getMetadata:function(a){if(this._metadata){var c;a(c,this._metadata)}else this.metadata(b.Util.bind(function(b,c){this._metadata=c,a(b,this._metadata)},this))},addFeature:function(a,b,c){this.addFeatures(a,b,c)},addFeatures:function(a,c,d){this._getMetadata(b.Util.bind(function(e,f){if(e)return void(c&&c.call(this,e,null));var g=a.features?a.features:[a];this.service.addFeatures(a,b.Util.bind(function(a,b){if(!a){for(var e=g.length-1;e>=0;e--)g[e].properties[f.objectIdField]=g.length>1?b[e].objectId:b.objectId,g[e].id=g.length>1?b[e].objectId:b.objectId;this.createLayers(g)}c&&c.call(d,a,b)},this))},this))},updateFeature:function(a,b,c){this.updateFeatures(a,b,c)},updateFeatures:function(a,b,c){var d=a.features?a.features:[a];this.service.updateFeatures(a,function(a,e){if(!a){for(var f=d.length-1;f>=0;f--)this.removeLayers([d[f].id],!0);this.createLayers(d)}b&&b.call(c,a,e)},this)},deleteFeature:function(a,b,c){this.deleteFeatures(a,b,c)},deleteFeatures:function(a,b,c){return this.service.deleteFeatures(a,function(a,d){var e=d.length?d:[d];if(!a&&e.length>0)for(var f=e.length-1;f>=0;f--)this.removeLayers([e[f].objectId],!0);b&&b.call(c,a,d)},this)}}),Ha=Ga.extend({options:{cacheLayers:!0},initialize:function(a){Ga.prototype.initialize.call(this,a),this._originalStyle=this.options.style,this._layers={}},onRemove:function(a){for(var b in this._layers)a.removeLayer(this._layers[b]),this.fire("removefeature",{feature:this._layers[b].feature,permanent:!1},!0);return Ga.prototype.onRemove.call(this,a)},createNewLayer:function(a){var c=b.GeoJSON.geometryToLayer(a,this.options);return c&&(c.defaultOptions=c.options),c},_updateLayer:function(a,c){var d=[],e=this.options.coordsToLatLng||b.GeoJSON.coordsToLatLng;switch(c.properties&&(a.feature.properties=c.properties),c.geometry.type){case"Point":d=b.GeoJSON.coordsToLatLng(c.geometry.coordinates),a.setLatLng(d);break;case"LineString":d=b.GeoJSON.coordsToLatLngs(c.geometry.coordinates,0,e),a.setLatLngs(d);break;case"MultiLineString":d=b.GeoJSON.coordsToLatLngs(c.geometry.coordinates,1,e),a.setLatLngs(d);break;case"Polygon":d=b.GeoJSON.coordsToLatLngs(c.geometry.coordinates,1,e),a.setLatLngs(d);break;case"MultiPolygon":d=b.GeoJSON.coordsToLatLngs(c.geometry.coordinates,2,e),a.setLatLngs(d)}},createLayers:function(a){for(var b=a.length-1;b>=0;b--){var c,d=a[b],e=this._layers[d.id];this._visibleZoom()&&e&&!this._map.hasLayer(e)&&(this._map.addLayer(e),this.fire("addfeature",{feature:e.feature},!0)),e&&this.options.simplifyFactor>0&&(e.setLatLngs||e.setLatLng)&&this._updateLayer(e,d),e||(c=this.createNewLayer(d),c?(c.feature=d,c.addEventParent(this),this.options.onEachFeature&&this.options.onEachFeature(c.feature,c),this._layers[c.feature.id]=c,this.setFeatureStyle(c.feature.id,this.options.style),this.fire("createfeature",{feature:c.feature},!0),this._visibleZoom()&&(!this.options.timeField||this.options.timeField&&this._featureWithinTimeRange(d))&&this._map.addLayer(c)):H("invalid GeoJSON encountered"))}},addLayers:function(a){for(var b=a.length-1;b>=0;b--){var c=this._layers[a[b]];c&&this._map.addLayer(c)}},removeLayers:function(a,b){for(var c=a.length-1;c>=0;c--){var d=a[c],e=this._layers[d];e&&(this.fire("removefeature",{feature:e.feature,permanent:b},!0),this._map.removeLayer(e)),e&&b&&delete this._layers[d]}},cellEnter:function(a,c){this._visibleZoom()&&!this._zooming&&this._map&&b.Util.requestAnimFrame(b.Util.bind(function(){var a=this._cacheKey(c),b=this._cellCoordsToKey(c),d=this._cache[a];this._activeCells[b]&&d&&this.addLayers(d)},this))},cellLeave:function(a,c){this._zooming||b.Util.requestAnimFrame(b.Util.bind(function(){if(this._map){var a=this._cacheKey(c),b=this._cellCoordsToKey(c),d=this._cache[a],e=this._map.getBounds();if(!this._activeCells[b]&&d){for(var f=!0,g=0;g<d.length;g++){var h=this._layers[d[g]];h&&h.getBounds&&e.intersects(h.getBounds())&&(f=!1)}f&&this.removeLayers(d,!this.options.cacheLayers),!this.options.cacheLayers&&f&&(delete this._cache[a],delete this._cells[b],delete this._activeCells[b])}}},this))},resetStyle:function(){return this.options.style=this._originalStyle,this.eachFeature(function(a){this.resetFeatureStyle(a.feature.id)},this),this},setStyle:function(a){return this.options.style=a,this.eachFeature(function(b){this.setFeatureStyle(b.feature.id,a)},this),this},resetFeatureStyle:function(a){var c=this._layers[a],d=this._originalStyle||b.Path.prototype.options;return c&&(b.Util.extend(c.options,c.defaultOptions),this.setFeatureStyle(a,d)),this},setFeatureStyle:function(a,b){var c=this._layers[a];return"function"==typeof b&&(b=b(c.feature)),c.setStyle&&c.setStyle(b),this},eachActiveFeature:function(a,b){if(this._map){var c=this._map.getBounds();for(var d in this._layers)-1!==this._currentSnapshot.indexOf(this._layers[d].feature.id)&&("function"==typeof this._layers[d].getLatLng&&c.contains(this._layers[d].getLatLng())?a.call(b,this._layers[d]):"function"==typeof this._layers[d].getBounds&&c.intersects(this._layers[d].getBounds())&&a.call(b,this._layers[d]))}return this},eachFeature:function(a,b){for(var c in this._layers)a.call(b,this._layers[c]);return this},getFeature:function(a){return this._layers[a]},bringToBack:function(){this.eachFeature(function(a){a.bringToBack&&a.bringToBack()})},bringToFront:function(){this.eachFeature(function(a){a.bringToFront&&a.bringToFront()})},redraw:function(a){return a&&this._redraw(a),this},_redraw:function(a){var c=this._layers[a],d=c.feature;if(c&&c.setIcon&&this.options.pointToLayer&&this.options.pointToLayer){var e=this.options.pointToLayer(d,b.latLng(d.geometry.coordinates[1],d.geometry.coordinates[0])),f=e.options.icon;c.setIcon(f)}if(c&&c.setStyle&&this.options.pointToLayer){var g=this.options.pointToLayer(d,b.latLng(d.geometry.coordinates[1],d.geometry.coordinates[0])),h=g.options;this.setFeatureStyle(d.id,h)}c&&c.setStyle&&this.options.style&&this.resetStyle(d.id)}}),Ia=Ga.extend({statics:{EVENTS:"click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose",CLUSTEREVENTS:"clusterclick clusterdblclick clustermouseover clustermouseout clustermousemove clustercontextmenu"},initialize:function(a){Ga.prototype.initialize.call(this,a),a=L.setOptions(this,a),this._layers={},this._leafletIds={},this.cluster=L.markerClusterGroup(a),this._key="c"+(1e9*Math.random()).toString(36).replace(".","_"),this.cluster.addEventParent(this)},onAdd:function(a){Ga.prototype.onAdd.call(this,a),this._map.addLayer(this.cluster)},onRemove:function(a){Ga.prototype.onRemove.call(this,a),this._map.removeLayer(this.cluster)},createLayers:function(a){for(var b=[],c=a.length-1;c>=0;c--){var d=a[c],e=this._layers[d.id];e||(e=L.GeoJSON.geometryToLayer(d,this.options),e.feature=L.GeoJSON.asFeature(d),e.defaultOptions=e.options,e._leaflet_id=this._key+"_"+d.id,this.resetStyle(e.feature.id),this._layers[e.feature.id]=e,this._leafletIds[e._leaflet_id]=d.id,this.options.onEachFeature&&this.options.onEachFeature(e.feature,e),this.fire("createfeature",{feature:e.feature})),(!this.options.timeField||this.options.timeField&&this._featureWithinTimeRange(d))&&b.push(e)}b.length&&this.cluster.addLayers(b)},addLayers:function(a){for(var b=[],c=a.length-1;c>=0;c--){var d=this._layers[a[c]];this.fire("addfeature",{feature:d.feature}),b.push(d)}this.cluster.addLayers(b)},removeLayers:function(a,b){
for(var c=[],d=a.length-1;d>=0;d--){var e=a[d],f=this._layers[e];this.fire("removefeature",{feature:f.feature,permanent:b}),c.push(f),this._layers[e]&&b&&delete this._layers[e]}this.cluster.removeLayers(c)},resetStyle:function(a){var b=this._layers[a];return b&&(b.options=b.defaultOptions,this.setFeatureStyle(b.feature.id,this.options.style)),this},setStyle:function(a){return this.eachFeature(function(b){this.setFeatureStyle(b.feature.id,a)},this),this},setFeatureStyle:function(a,b){var c=this._layers[a];"function"==typeof b&&(b=b(c.feature)),c.setStyle&&c.setStyle(b)},eachFeature:function(a,b){for(var c in this._layers)a.call(b,this._layers[c]);return this},getFeature:function(a){return this._layers[a]}}),Ja=Ga.extend({initialize:function(a){Ga.prototype.initialize.call(this,a),a=L.setOptions(this,a),this._cache={},this._active={},this.heat=window.L.heatLayer([],a)},onAdd:function(a){Ga.prototype.onAdd.call(this,a),this._map.addLayer(this.heat)},onRemove:function(a){Ga.prototype.onRemove.call(this,a),this._map.removeLayer(this.heat)},createLayers:function(a){for(var b=[],c=a.length-1;c>=0;c--){var d=[],e=a[c];d[0]=e.geometry.coordinates[1],d[1]=e.geometry.coordinates[0],d[2]=100*Math.random(),b.push(d)}var f=new Aqsc.MarkerHeatPoints(b);f.addToMap()},addLayers:function(a){for(var b=a.length-1;b>=0;b--){var c=a[b];if(!this._active[c]){var d=this._cache[c];this.heat._latlngs.push(d),this._active[c]=d}}this.heat.redraw()},removeLayers:function(a,b){for(var c=[],d=a.length-1;d>=0;d--){var e=a[d];this._active[e]&&delete this._active[e],this._cache[e]&&b&&delete this._cache[e]}for(var f in this._active)c.push(this._active[f]);this.heat.setLatLngs(c)},setOptions:function(a){this.heat.setOptions(a)},redraw:function(){this.heat.redraw()}});a.VERSION=ea,a.Support=ha,a.options=ia,a.Util=na,a.get=ka,a.post=e,a.request=g,a.Task=oa,a.task=O,a.Query=pa,a.query=P,a.Find=qa,a.find=Q,a.Identify=ra,a.identify=R,a.IdentifyFeatures=sa,a.identifyFeatures=S,a.IdentifyImage=ta,a.identifyImage=T,a.Service=ua,a.service=U,a.MapService=va,a.mapService=V,a.ImageService=wa,a.imageService=W,a.FeatureLayerService=xa,a.featureLayerService=X,a.BasemapLayer=za,a.basemapLayer=Y,a.TiledMapLayer=Aa,a.tiledMapLayer=Z,a.RasterLayer=Ca,a.ImageMapLayer=Da,a.imageMapLayer=$,a.DynamicMapLayer=Ea,a.dynamicMapLayer=_,a.FeatureManager=Ga,a.FeatureLayer=Ha,a.featureLayer=ba,a.FeatureClusterLayer=Ia,a.featureClusterLayer=ca,a.HeatMapFeatureLayer=Ja,a.heatMapFeatureLayer=da,Object.defineProperty(a,"__esModule",{value:!0})});